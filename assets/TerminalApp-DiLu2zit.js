import{r as a,j as p,u as Fe}from"./index-CgCM4PKA.js";const X={background:"#282c34",foreground:"#abb2bf",prompt:"#98c379",success:"#98c379",error:"#e06c75",warning:"#e5c07b",directory:"#61afef",file:"#abb2bf",executable:"#c678dd",comment:"#5c6370",selection:"#3e4451",cursor:"#528bff"},fe={background:"#0c0c0c",foreground:"#cccccc",prompt:"#ffffff",success:"#00ff00",error:"#ff0000",warning:"#ffff00",directory:"#00ffff",file:"#cccccc",executable:"#ff00ff",comment:"#808080",selection:"#264f78",cursor:"#ffffff"};class U{static ANSI_COLORS={reset:"\x1B[0m",bold:"\x1B[1m",dim:"\x1B[2m",italic:"\x1B[3m",underline:"\x1B[4m",black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",bgBlack:"\x1B[40m",bgRed:"\x1B[41m",bgGreen:"\x1B[42m",bgYellow:"\x1B[43m",bgBlue:"\x1B[44m",bgMagenta:"\x1B[45m",bgCyan:"\x1B[46m",bgWhite:"\x1B[47m"};static ansiToHtml(e){const t={"\x1B[0m":"</span>","\x1B[1m":'<span style="font-weight: bold;">',"\x1B[2m":'<span style="opacity: 0.5;">',"\x1B[3m":'<span style="font-style: italic;">',"\x1B[4m":'<span style="text-decoration: underline;">',"\x1B[30m":'<span style="color: #000000;">',"\x1B[31m":'<span style="color: #e06c75;">',"\x1B[32m":'<span style="color: #98c379;">',"\x1B[33m":'<span style="color: #e5c07b;">',"\x1B[34m":'<span style="color: #61afef;">',"\x1B[35m":'<span style="color: #c678dd;">',"\x1B[36m":'<span style="color: #56b6c2;">',"\x1B[37m":'<span style="color: #abb2bf;">',"\x1B[40m":'<span style="background-color: #000000;">',"\x1B[41m":'<span style="background-color: #e06c75;">',"\x1B[42m":'<span style="background-color: #98c379;">',"\x1B[43m":'<span style="background-color: #e5c07b;">',"\x1B[44m":'<span style="background-color: #61afef;">',"\x1B[45m":'<span style="background-color: #c678dd;">',"\x1B[46m":'<span style="background-color: #56b6c2;">',"\x1B[47m":'<span style="background-color: #abb2bf;">'};let o=e;return Object.entries(t).forEach(([n,s])=>{o=o.replace(new RegExp(n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),s)}),o}static colorize(e,t){return`${{success:this.ANSI_COLORS.green,error:this.ANSI_COLORS.red,warning:this.ANSI_COLORS.yellow,info:this.ANSI_COLORS.cyan,directory:this.ANSI_COLORS.blue,file:this.ANSI_COLORS.white,executable:this.ANSI_COLORS.magenta}[t]}${e}${this.ANSI_COLORS.reset}`}static formatFileList(e){return e.map(t=>t.isDirectory?this.colorize(`${t.name}/`,"directory"):t.isExecutable?this.colorize(t.name,"executable"):this.colorize(t.name,"file")).join("  ")}}class Pe{static highlight(e,t){const o=e.split(" ");if(o.length===0)return e;const n=o[0];let c=t?.hasCommand(n)||!1?`<span style="color: #98c379; font-weight: bold;">${n}</span>`:`<span style="color: #e06c75;">${n}</span>`;if(o.length>1){const i=o.slice(1).join(" ");c+=` <span style="color: #abb2bf;">${i}</span>`}return c}static isValidCommand(e,t){return t?.hasCommand(e)||!1}}class oe{pool=[];maxSize;createFn;resetFn;constructor(e,t,o=100){this.createFn=e,this.resetFn=t,this.maxSize=o}acquire(){return this.pool.length>0?this.pool.pop():this.createFn()}release(e){this.pool.length<this.maxSize&&(this.resetFn(e),this.pool.push(e))}getStats(){return{poolSize:this.pool.length,maxSize:this.maxSize}}clear(){this.pool.length=0}}const Re=()=>({id:`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,content:"",type:"output",timestamp:new Date,className:""}),He=r=>{r.id=`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r.content="",r.type="output",r.timestamp=new Date,r.className=""},Y=new oe(Re,He,200),_=new Map,V={get(r,e){if(_.has(r))return _.get(r);const t=e();if(_.size>=500){const o=Array.from(_.entries()),n=Math.floor(o.length*.5);_.clear(),o.slice(-n).forEach(([s,c])=>_.set(s,c))}return _.set(r,t),t},clear(){_.clear()},getStats(){return{cacheSize:_.size,maxSize:500}}},Ae=()=>({type:"",key:"",ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,preventDefault:()=>{},stopPropagation:()=>{}}),We=r=>{r.type="",r.key="",r.ctrlKey=!1,r.shiftKey=!1,r.altKey=!1,r.metaKey=!1},pe=new oe(Ae,We,50),ze=()=>({start:0,end:0,type:"identifier",content:""}),Oe=r=>{r.start=0,r.end=0,r.type="identifier",r.content=""},Z=new oe(ze,Oe,1e3),ee={getAllStats(){return{terminalLines:Y.getStats(),styles:V.getStats(),events:pe.getStats(),syntaxTokens:Z.getStats()}},clearAll(){Y.clear(),V.clear(),pe.clear(),Z.clear()},forceGC(){typeof window.gc=="function"&&window.gc()}},Ve=({line:r,theme:e,isLast:t})=>{const o=a.useMemo(()=>{switch(r.type){case"input":case"output":return e.foreground;case"error":return e.error;case"success":return e.success;case"warning":return e.warning;case"info":return e.comment;default:return e.foreground}},[r.type,e.foreground,e.error,e.success,e.warning,e.comment]),n=a.useMemo(()=>{const l=`line-${r.type}-${o}`;return V.get(l,()=>{const u={color:o,fontFamily:'Monaco, Menlo, "Ubuntu Mono", Consolas, "Courier New", monospace',fontSize:"14px",lineHeight:"1.4",whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word",margin:0,padding:"2px 0"};return["input","error","success","warning"].includes(r.type)?{...u,fontWeight:500}:u})},[r.type,o]),{needsHtmlRendering:s,processedContent:c}=a.useMemo(()=>{const l=r.content.includes("<span")||r.content.includes("</span>"),u=r.content.includes("\x1B[");return{needsHtmlRendering:l||u,processedContent:u?U.ansiToHtml(r.content):r.content}},[r.content]),i=a.useCallback(l=>{l&&t&&typeof l.scrollIntoView=="function"&&l.scrollIntoView({behavior:"smooth"})},[t]);return p.jsx("div",{style:n,className:`terminal-line terminal-line--${r.type} ${r.className||""}`,"data-line-id":r.id,"data-timestamp":r.timestamp.toISOString(),ref:t?i:void 0,children:s?p.jsx("span",{dangerouslySetInnerHTML:{__html:c}}):c})},xe=a.memo(Ve,(r,e)=>r.line.id===e.line.id&&r.line.content===e.line.content&&r.line.type===e.line.type&&r.isLast===e.isLast&&r.theme===e.theme);xe.displayName="TerminalLine";const we=a.memo(({currentDirectory:r,osType:e,username:t,hostname:o,theme:n,isExecuting:s=!1})=>{const c=()=>e==="windows"?`${`C:\\${r.replace(/\//g,"\\")}`}> `:`${t}@${o}:${r==="/Desktop"?"~":r}$ `,i=()=>{if(e==="windows"){const m=`C:\\${r.replace(/\//g,"\\")}`;return p.jsxs("span",{style:{color:n.prompt},children:[m,"> "]})}const u=r==="/Desktop"?"~":r;return p.jsxs(p.Fragment,{children:[p.jsx("span",{style:{color:n.success,fontWeight:"bold"},children:t}),p.jsx("span",{style:{color:n.foreground},children:"@"}),p.jsx("span",{style:{color:n.directory,fontWeight:"bold"},children:o}),p.jsx("span",{style:{color:n.foreground},children:":"}),p.jsx("span",{style:{color:n.directory,fontWeight:"bold"},children:u}),p.jsx("span",{style:{color:n.prompt,fontWeight:"bold"},children:"$ "})]})},l={fontFamily:'Monaco, Menlo, "Ubuntu Mono", Consolas, "Courier New", monospace',fontSize:"14px",lineHeight:"1.4",display:"inline-flex",alignItems:"center",userSelect:"none",opacity:s?.7:1};return p.jsxs("span",{style:l,className:"terminal-prompt","aria-label":c(),children:[i(),p.jsx("span",{style:{position:"absolute",left:"-9999px"},children:c()})]})});we.displayName="TerminalPrompt";const Ke=({value:r,onChange:e,onKeyDown:t,currentDirectory:o,osType:n,username:s,hostname:c,theme:i,isExecuting:l,cursorPosition:u,suggestions:m,selectedSuggestion:S,showSuggestions:L,commandRegistry:N})=>{const I=a.useRef(null),j=a.useRef(null),T=a.useRef(null),[,k]=a.useState(!1),[v,g]=a.useState(0);a.useLayoutEffect(()=>{if(T.current){const{width:M}=T.current.getBoundingClientRect();g(M)}},[o,n,s,c,i]),a.useEffect(()=>{!l&&I.current&&I.current.focus()},[l]);const f=a.useCallback(M=>{const x=M.target.value,D=M.target.selectionStart||0;e(x,D)},[e]),b=a.useCallback(M=>{const{nativeEvent:x}=M;t(x)},[t]),d=a.useCallback(M=>{const x=r.split(/\s+/),D=r.substring(0,u),W=Math.max(0,D.split(/\s+/).length-1);x[W]=M;const R=x.join(" ");e(R,R.length),I.current&&I.current.focus()},[r,u,e]),w=a.useMemo(()=>{const M=`container-${i.background}`;return V.get(M,()=>({position:"relative",display:"flex",alignItems:"center",padding:"8px 8px",backgroundColor:i.background,minHeight:"40px"}))},[i.background]),h=a.useMemo(()=>V.get("input-container",()=>({position:"relative",flex:1,display:"flex",alignItems:"center"})),[]),y=a.useMemo(()=>{const M=`input-${i.foreground}-${i.cursor}-${v}`;return V.get(M,()=>({background:"transparent",border:"none",outline:"none",color:i.foreground,caretColor:i.cursor,fontFamily:'Monaco, Menlo, "Ubuntu Mono", Consolas, "Courier New", monospace',fontSize:"14px",lineHeight:"1.4",width:"100%",position:"relative",overflowWrap:"anywhere",wordBreak:"break-word",minHeight:"20px",marginLeft:"4px"}))},[i.foreground,i.cursor,v]),E=a.useMemo(()=>{const M=`suggestions-${i.background}-${i.selection}`;return V.get(M,()=>({position:"absolute",bottom:"100%",left:0,right:0,maxHeight:"200px",overflowY:"auto",backgroundColor:i.background,border:`1px solid ${i.selection}`,borderRadius:"4px",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"}))},[i.background,i.selection]),F=a.useCallback(M=>{const x=`suggestion-${M}-${S}-${i.selection}-${i.foreground}-${i.comment}`;return V.get(x,()=>({padding:"8px 12px",fontSize:"14px",fontFamily:'Monaco, Menlo, "Ubuntu Mono", Consolas, "Courier New", monospace',cursor:"pointer",backgroundColor:M===S?i.selection:"transparent",color:M===S?i.foreground:i.comment,borderBottom:M<m.length-1?`1px solid ${i.selection}`:"none"}))},[S,m.length,i.selection,i.foreground,i.comment]),$=a.useMemo(()=>!r||!N||r.length>1e3?"":Pe.highlight(r,N),[r,N]),B=a.useMemo(()=>{const M=`highlight-overlay-${v}`;return V.get(M,()=>({position:"absolute",top:0,left:"4px",right:0,bottom:0,pointerEvents:"none",fontFamily:'Monaco, Menlo, "Ubuntu Mono", Consolas, "Courier New", monospace',fontSize:"14px",lineHeight:"1.4",color:"transparent",backgroundColor:"transparent",border:"none",outline:"none",padding:0,margin:0,whiteSpace:"pre",overflowWrap:"anywhere",overflow:"hidden"}))},[v]);return p.jsxs("div",{style:w,className:"terminal-input-container",children:[p.jsx("span",{ref:T,children:p.jsx(we,{currentDirectory:o,osType:n,username:s,hostname:c,theme:i,isExecuting:l})}),p.jsxs("div",{style:h,children:[$&&p.jsx("div",{style:B,dangerouslySetInnerHTML:{__html:$},"aria-hidden":"true"}),p.jsx("input",{ref:I,type:"text",value:r,onChange:f,onKeyDown:b,onFocus:()=>k(!0),onBlur:()=>k(!1),style:{...y,color:$?"transparent":i.foreground,backgroundColor:"transparent"},disabled:l,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,"aria-label":"Terminal command input",className:"terminal-input"}),L&&m.length>0&&p.jsx("div",{ref:j,style:E,className:"terminal-suggestions",children:m.map((M,x)=>p.jsx("div",{style:F(x),onClick:()=>d(M),className:"terminal-suggestion",children:M},x))})]}),l&&p.jsx("div",{style:{marginLeft:"8px",color:i.comment,fontSize:"12px"},children:p.jsx("span",{className:"terminal-spinner",children:"⠋"})}),p.jsx("style",{children:`
        @keyframes spin {
          0% { content: '⠋'; }
          12.5% { content: '⠙'; }
          25% { content: '⠹'; }
          37.5% { content: '⠸'; }
          50% { content: '⠼'; }
          62.5% { content: '⠴'; }
          75% { content: '⠦'; }
          87.5% { content: '⠧'; }
          100% { content: '⠇'; }
        }
        .terminal-spinner {
          animation: spin 1s linear infinite;
        }
      `})]})},Ce=a.memo(Ke,(r,e)=>r.value===e.value&&r.cursorPosition===e.cursorPosition&&r.isExecuting===e.isExecuting&&r.showSuggestions===e.showSuggestions&&r.selectedSuggestion===e.selectedSuggestion&&r.suggestions===e.suggestions&&r.theme===e.theme&&r.currentDirectory===e.currentDirectory&&r.osType===e.osType&&r.username===e.username&&r.hostname===e.hostname&&r.commandRegistry===e.commandRegistry);Ce.displayName="TerminalInput";const Q=24,he=10,Ue=({output:r,theme:e,autoScroll:t=!0,maxLines:o=1e3,currentInput:n,onInputChange:s,onKeyDown:c,currentDirectory:i,osType:l,username:u,hostname:m,isExecuting:S,cursorPosition:L,suggestions:N,selectedSuggestion:I,showSuggestions:j,commandRegistry:T})=>{const k=a.useRef(null),v=a.useRef(!1),g=a.useRef(void 0),[f,b]=a.useState(0),[d,w]=a.useState(0),h=a.useMemo(()=>r.slice(-o),[r,o]),{startIndex:y,endIndex:E,totalHeight:F}=a.useMemo(()=>{const H=h.length,A=Math.floor(f/Q)-he,P=Math.ceil(d/Q),z=A+P+he*2;return{startIndex:Math.max(0,A),endIndex:Math.min(H,z),totalHeight:H*Q}},[f,d,h.length]),$=a.useMemo(()=>h.slice(y,E),[h,y,E]),B=a.useCallback(()=>{const H=k.current;if(!H)return;const{scrollTop:A,scrollHeight:P,clientHeight:z}=H,q=P-A-z<10;b(A),w(z),v.current=!q,g.current&&window.clearTimeout(g.current),g.current=window.setTimeout(()=>{v.current=!1},1e3)},[]);a.useEffect(()=>{if(!t||v.current)return;const H=k.current;H&&(H.scrollTop=H.scrollHeight)},[r,t]),a.useEffect(()=>{const H=k.current;H&&w(H.clientHeight)},[]);const M=a.useMemo(()=>{const H=`output-${e.background}-${e.comment}`;return V.get(H,()=>({flex:1,display:"flex",flexDirection:"column",overflowY:"auto",overflowX:"hidden",backgroundColor:e.background,scrollBehavior:"smooth",scrollbarWidth:"thin",scrollbarColor:`${e.comment} ${e.background}`}))},[e.background,e.comment]),x=a.useMemo(()=>V.get("content",()=>({position:"relative",height:`${F}px`,padding:"8px 8px"})),[F]),D=a.useMemo(()=>V.get("input-container",()=>({padding:"0",minHeight:"auto"})),[]),W=a.useMemo(()=>`
    .terminal-output::-webkit-scrollbar {
      width: 8px;
    }
    .terminal-output::-webkit-scrollbar-track {
      background: ${e.background};
    }
    .terminal-output::-webkit-scrollbar-thumb {
      background-color: ${e.comment};
      border-radius: 4px;
      border: 2px solid ${e.background};
    }
    .terminal-output::-webkit-scrollbar-thumb:hover {
      background-color: ${e.foreground};
    }
  `,[e.background,e.comment,e.foreground]),R=a.useMemo(()=>n!==void 0&&s&&c&&i&&l&&u&&m,[n,s,c,i,l,u,m]),O=a.useMemo(()=>V.get("virtual-list",()=>({position:"absolute",top:`${y*Q}px`,left:0,right:0})),[y]);return p.jsxs(p.Fragment,{children:[p.jsx("style",{children:W}),p.jsxs("div",{ref:k,style:M,className:"terminal-output",onScroll:B,role:"log","aria-live":"polite","aria-label":"Terminal output",children:[p.jsx("div",{style:x,children:h.length===0?p.jsx("div",{style:{color:e.comment,fontStyle:"italic",padding:"20px 0",textAlign:"center"},children:"Terminal ready - type a command to get started"}):p.jsx("div",{style:O,children:$.map((H,A)=>{const P=y+A,z=H.id&&H.id.trim()!==""?`${H.id}-${P}`:`line-${P}-${H.timestamp?.getTime()||Date.now()}`;return p.jsx("div",{style:{height:`${Q}px`},children:p.jsx(xe,{line:H,theme:e,isLast:P===h.length-1})},z)})})}),R&&p.jsx("div",{style:D,children:p.jsx(Ce,{value:n,onChange:s,onKeyDown:c,currentDirectory:i,osType:l,username:u,hostname:m,theme:e,isExecuting:S||!1,cursorPosition:L||0,suggestions:N||[],selectedSuggestion:I||-1,showSuggestions:j||!1,commandRegistry:T})})]})]})},Se=a.memo(Ue,(r,e)=>r.output.length===e.output.length&&r.output===e.output&&r.theme===e.theme&&r.autoScroll===e.autoScroll&&r.maxLines===e.maxLines&&r.currentInput===e.currentInput&&r.isExecuting===e.isExecuting&&r.cursorPosition===e.cursorPosition&&r.showSuggestions===e.showSuggestions);Se.displayName="TerminalOutput";const _e=({state:r,theme:e,filename:t})=>{const n=(()=>{switch(r.mode){case"normal":return{text:"NORMAL",color:e.syntax.keyword};case"insert":return{text:"INSERT",color:e.syntax.string};case"visual":return{text:"VISUAL",color:e.syntax.number};case"command":return{text:"COMMAND",color:e.syntax.type};default:return{text:"NORMAL",color:e.syntax.keyword}}})(),s=()=>{let j="";return r.isModified&&(j+="[+] "),t||(j+="[No Name] "),j},c=()=>{const j=r.cursor.line+1,T=r.cursor.column+1,k=r.buffer.length,v=Math.round(j/k*100);return`${j},${T} ${v}%`},i=()=>{if(!t)return"";const j=t.split(".").pop()?.toLowerCase();switch(j){case"ts":case"tsx":return"TypeScript";case"js":case"jsx":return"JavaScript";case"md":return"Markdown";case"json":return"JSON";case"txt":return"Text";default:return j?j.toUpperCase():""}},l={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 12px",backgroundColor:e.statusBackground,color:e.statusForeground,fontSize:"12px",fontWeight:"bold",borderTop:`1px solid ${e.currentLineBackground}`,minHeight:"24px"},u={display:"flex",alignItems:"center",gap:"12px"},m={display:"flex",alignItems:"center",gap:"12px"},S={padding:"2px 8px",borderRadius:"3px",backgroundColor:n.color,color:e.background,fontSize:"11px",fontWeight:"bold"},L={display:"flex",alignItems:"center",gap:"8px"},N={color:r.messageType==="error"?e.syntax.string:r.messageType==="warning"?e.syntax.number:e.statusForeground,fontStyle:r.messageType==="info"?"italic":"normal"},I={color:e.syntax.comment,fontSize:"11px"};return p.jsxs(p.Fragment,{children:[p.jsxs("div",{style:l,className:"vim-status-bar",children:[p.jsxs("div",{style:u,children:[p.jsx("div",{style:S,children:n.text}),p.jsxs("div",{style:L,children:[p.jsx("span",{children:t||"[No Name]"}),p.jsx("span",{children:s()}),r.message&&p.jsx("span",{style:N,children:r.message})]})]}),p.jsxs("div",{style:m,children:[i()&&p.jsx("span",{style:I,children:i()}),p.jsx("span",{children:c()}),p.jsxs("span",{children:[r.buffer.length," lines"]})]})]}),r.mode==="command"&&p.jsxs("div",{style:{padding:"2px 12px",backgroundColor:e.background,color:e.foreground,fontSize:"14px",borderTop:`1px solid ${e.currentLineBackground}`,fontFamily:"inherit"},className:"vim-command-line",children:[":",r.commandInput,p.jsx("span",{style:{animation:"vim-blink 1s infinite",marginLeft:"1px"},children:"█"})]})]})},qe=new Set(["abstract","any","as","async","await","boolean","break","case","catch","class","const","constructor","continue","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","instanceof","interface","is","keyof","let","module","namespace","never","new","null","number","object","of","package","private","protected","public","readonly","require","return","set","static","string","super","switch","symbol","this","throw","true","try","type","typeof","undefined","union","unique","unknown","var","void","while","with","yield"]),Ge=new Set(["Array","Boolean","Date","Error","Function","Map","Number","Object","Promise","RegExp","Set","String","Symbol","WeakMap","WeakSet","React","Component","Element","HTMLElement","Node","NodeList","EventTarget"]),J=new Set(["+","-","*","/","%","**","++","--","=","+=","-=","*=","/=","%=","==","===","!=","!==","<",">","<=",">=","&&","||","!","&","|","^","~","<<",">>",">>>","?",":","=>","...","??","?.","??="]);function Ye(r){if(!r)return"text";switch(r.split(".").pop()?.toLowerCase()){case"ts":case"tsx":return"typescript";case"js":case"jsx":return"javascript";case"md":return"markdown";case"json":return"json";case"css":return"css";case"html":case"htm":return"html";default:return"text"}}function K(r,e,t){const o=Z.acquire();return o.start=r,o.end=e,o.type=t,o}function Qe(r){const e=[];let t=0;for(;t<r.length;){const o=r[t];if(/\s/.test(o)){t++;continue}if(o==='"'||o==="'"||o==="`"){const n=t,s=o;for(t++;t<r.length&&r[t]!==s;)r[t]==="\\"&&t++,t++;t<r.length&&t++,e.push(K(n,t,"string"));continue}if(o==="/"&&r[t+1]==="/"){e.push(K(t,r.length,"comment"));break}if(o==="/"&&r[t+1]==="*"){const n=t;for(t+=2;t<r.length-1&&!(r[t]==="*"&&r[t+1]==="/");)t++;t<r.length-1&&(t+=2),e.push(K(n,t,"comment"));continue}if(/\d/.test(o)){const n=t;for(;t<r.length&&/[\d.]/.test(r[t]);)t++;e.push(K(n,t,"number"));continue}if(/[a-zA-Z_$]/.test(o)){const n=t;for(;t<r.length&&/[a-zA-Z0-9_$]/.test(r[t]);)t++;const s=r.slice(n,t);let c="identifier";qe.has(s)?c="keyword":Ge.has(s)&&(c="type"),e.push(K(n,t,c));continue}if(J.has(o)||J.has(r.slice(t,t+2))||J.has(r.slice(t,t+3))){const n=t;J.has(r.slice(t,t+3))?t+=3:J.has(r.slice(t,t+2))?t+=2:t++,e.push(K(n,t,"operator"));continue}t++}return e}function Je(r){const e=[];if(r.startsWith("#"))return e.push(K(0,r.length,"keyword")),e;if(r.startsWith("```"))return e.push(K(0,r.length,"string")),e;let t=0;for(;t<r.length;)if(r[t]==="`"){const o=t;for(t++;t<r.length&&r[t]!=="`";)t++;t<r.length&&t++,e.push(K(o,t,"string"))}else t++;return e}function Ze(r){const e=[];let t=0;for(;t<r.length;){const o=r[t];if(/\s/.test(o)){t++;continue}if(o==='"'){const n=t;for(t++;t<r.length&&r[t]!=='"';)r[t]==="\\"&&t++,t++;t<r.length&&t++,e.push(K(n,t,"string"));continue}if(/\d/.test(o)||o==="-"){const n=t;for(o==="-"&&t++;t<r.length&&/[\d.]/.test(r[t]);)t++;e.push(K(n,t,"number"));continue}if(/[a-z]/.test(o)){const n=t;for(;t<r.length&&/[a-z]/.test(r[t]);)t++;const s=r.slice(n,t);["true","false","null"].includes(s)&&e.push(K(n,t,"keyword"));continue}t++}return e}function Xe(){const r=a.useRef(new Map),e=500,t=a.useMemo(()=>new Map,[]),o=a.useCallback(i=>{if(!i)return"text";if(t.has(i))return t.get(i);const l=Ye(i);return t.set(i,l),l},[t]),n=a.useCallback((i,l)=>{const u=`${l||"text"}:${i}`;if(r.current.has(u))return r.current.get(u);if(i.length>5e3)return{text:i,tokens:[]};r.current.size>e*1.2&&(console.warn("Vim Syntax: Emergency cache clear, size:",r.current.size),r.current.clear(),t.clear());const m=o(l);let S=[];try{switch(m){case"typescript":case"javascript":S=Qe(i);break;case"markdown":S=Je(i);break;case"json":S=Ze(i);break;default:break}}catch(N){console.warn("Syntax highlighting error:",N),S=[]}const L={text:i,tokens:S};if(r.current.size>=e){const N=Array.from(r.current.keys()).slice(0,Math.floor(e*.7));N.forEach(I=>r.current.delete(I)),console.log(`Vim Syntax: Aggressive cache cleanup, removed ${N.length} entries`)}return r.current.set(u,L),L},[o]),s=a.useCallback(()=>{console.log(`Vim Syntax: Clearing cache with ${r.current.size} entries`),r.current.forEach(i=>{i.tokens.forEach(l=>Z.release(l))}),r.current.clear(),t.clear()},[t]),c=a.useCallback(()=>({syntaxCacheSize:r.current.size,languageCacheSize:t.size,maxCacheSize:e}),[t]);return a.useEffect(()=>{const i=setInterval(()=>{const l=r.current.size,u=t.size;if(l>e*.6){const m=Array.from(r.current.entries()),S=Math.floor(e*.3);r.current.clear(),m.slice(-S).forEach(([L,N])=>{r.current.set(L,N)}),console.log(`Vim Syntax: Periodic cleanup, ${l} -> ${S} entries`)}u>50&&(t.clear(),console.log(`Vim Syntax: Cleared language cache (${u} entries)`))},3e4);return()=>clearInterval(i)},[t]),{highlightLine:n,clearCache:s,getCacheStats:c}}const et=({state:r,theme:e})=>{const t=a.useRef(null),{highlightLine:o,clearCache:n,getCacheStats:s}=Xe(),[c,i]=a.useState([0,Math.min(r.buffer.length,50)]),l=a.useCallback(()=>{const b=t.current;if(!b)return[0,Math.min(r.buffer.length,50)];const d=20,w=b.clientHeight,{scrollTop:h}=b,y=Math.floor(h/d),E=Math.min(r.buffer.length,y+Math.ceil(w/d)+10),F=r.cursor.line,$=Math.max(0,Math.min(y-5,F-5)),B=Math.max(E,F+10);return[$,Math.min(B,r.buffer.length)]},[r.buffer.length,r.cursor.line]);a.useLayoutEffect(()=>{const b=l();i(b)},[l,r.buffer.length]),a.useLayoutEffect(()=>{const b=t.current;if(!b)return;const d=20,w=r.cursor.line*d,h=b.scrollTop,y=h+b.clientHeight;if(w<h||w>y-d){b.scrollTop=Math.max(0,w-b.clientHeight/2);const E=l();i(E)}},[r.cursor.line,r.cursor.column,l]),a.useEffect(()=>{const b=t.current;if(!b)return;let d,w;const h=()=>{clearTimeout(d),d=setTimeout(()=>{const F=l();i(F)},16)},y=()=>{clearTimeout(w),w=setTimeout(()=>{const $=r.cursor.line*20,B=b.scrollTop,M=B+b.clientHeight;if($<B||$>M-20){b.scrollTop=Math.max(0,$-b.clientHeight/2);const x=l();i(x)}},8)};return r.buffer.reduce((F,$)=>F+$.length,0)>5e5&&s().syntaxCacheSize>500&&(console.log("Vim TextBuffer: Clearing syntax cache for large buffer"),n()),b.addEventListener("scroll",h,{passive:!0}),y(),()=>{b.removeEventListener("scroll",h),clearTimeout(d),clearTimeout(w)}},[l,r.cursor,r.buffer,n,s]);const u=r.cursor.line,m=r.cursor.column,S=r.mode,L=r.filename,N=a.useMemo(()=>(b,d)=>{const w=o(b,L);let h="";const y=u===d,E=y?m:-1;if(b.length===0)return y?'<span class="vim-cursor">█</span>':"<span>&nbsp;</span>";const F=[];w.tokens.forEach(B=>{F.push({start:B.start,end:B.end,className:`vim-syntax-${B.type}`})}),y&&E>=0&&E<b.length&&S!=="insert"&&F.push({start:E,end:E+1,className:"vim-cursor",isCursor:!0}),F.sort((B,M)=>B.start-M.start);let $=0;for(const B of F){if($<B.start){const x=b.slice($,B.start);h+=I(x)}const M=b.slice(B.start,B.end);h+=`<span class="${B.className}">${I(M)}</span>`,$=Math.max($,B.end)}if($<b.length){const B=b.slice($);h+=I(B)}return y&&S==="insert"&&E===b.length&&(h+='<span class="vim-cursor">█</span>'),h||"&nbsp;"},[u,m,S,L,o]),I=b=>b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/ /g,"&nbsp;"),[j,T]=c,k={flex:1,overflow:"auto",padding:"8px 12px",backgroundColor:e.background,color:e.foreground,lineHeight:"20px",fontFamily:"inherit",fontSize:"inherit",whiteSpace:"pre-wrap",overflowWrap:"anywhere",position:"relative"},v={height:`${r.buffer.length*20}px`,position:"relative"},g={position:"absolute",top:`${j*20}px`,left:0,right:0},f=b=>({height:"20px",minHeight:"20px",backgroundColor:b===r.cursor.line?e.currentLineBackground:"transparent",padding:"0 4px",margin:0});return p.jsx("div",{ref:t,style:k,className:"vim-text-buffer",role:"textbox","aria-label":"Text editor content","aria-multiline":!0,children:p.jsx("div",{style:v,children:p.jsxs("div",{style:g,children:[r.buffer.slice(j,T).map((b,d)=>{const w=j+d,h=N(b,w);return p.jsx("div",{style:f(w),className:`vim-line ${w===r.cursor.line?"vim-current-line":""}`,dangerouslySetInnerHTML:{__html:h}},w)}),r.buffer.length===0&&p.jsx("div",{style:f(0),className:"vim-line vim-current-line",children:p.jsx("span",{className:"vim-cursor",children:"█"})})]})})})},tt=({buffer:r,currentLine:e,scrollOffset:t,viewportHeight:o,theme:n,relative:s=!1})=>{const c=()=>{const T=r.length,k=Math.max(2,Math.floor(Math.log10(T))+1);return Math.max(40,k*8+16)},i=T=>s&&T!==e?Math.abs(T-e).toString():(T+1).toString(),l=()=>{const k=Math.max(0,Math.floor(t/20)-5),v=Math.min(r.length,k+Math.ceil(o/20)+10);return[k,v]},[u,m]=l(),L={width:`${c()}px`,backgroundColor:n.background,borderRight:`1px solid ${n.currentLineBackground}`,overflow:"hidden",position:"relative",fontSize:"12px",lineHeight:"20px",fontFamily:"inherit"},N={height:`${r.length*20}px`,position:"relative"},I={position:"absolute",top:`${u*20}px`,left:0,right:0},j=T=>({height:"20px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"8px",color:T===e?n.currentLineNumber:n.lineNumber,backgroundColor:T===e?n.currentLineBackground:"transparent",fontWeight:T===e?"bold":"normal",cursor:"default",userSelect:"none"});return p.jsx("div",{style:L,className:"vim-line-numbers",children:p.jsx("div",{style:N,children:p.jsxs("div",{style:I,children:[r.slice(u,m).map((T,k)=>{const v=u+k;return p.jsx("div",{style:j(v),className:`vim-line-number ${v===e?"current":""}`,children:i(v)},v)}),r.length===0&&p.jsx("div",{style:j(0),className:"vim-line-number current",children:"1"})]})})})};class rt extends a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Vim Editor Error:",e),console.error("Error Info:",t),this.setState({error:e,errorInfo:t}),this.props.onError&&this.props.onError(e,t)}handleRestart=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})};render(){if(this.state.hasError){const{theme:e}=this.props,t={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",backgroundColor:e.background,color:e.foreground,fontFamily:'Monaco, Menlo, "Ubuntu Mono", Consolas, "Courier New", monospace',fontSize:"14px",padding:"20px",textAlign:"center"},o={color:e.syntax.keyword,fontSize:"18px",fontWeight:"bold",marginBottom:"16px"},n={color:e.foreground,marginBottom:"20px",maxWidth:"600px",wordWrap:"break-word"},s={backgroundColor:e.statusBackground,color:e.statusForeground,border:`1px solid ${e.foreground}`,padding:"8px 16px",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontFamily:"inherit"};return e.currentLineBackground,`${e.lineNumber}`,p.jsxs("div",{style:t,children:[p.jsx("div",{style:o,children:"🔧 Vim Editor Error"}),p.jsx("div",{style:n,children:"The vim editor encountered an unexpected error and has been safely contained. Your work in other applications is not affected."}),p.jsx("button",{style:s,onClick:this.handleRestart,onMouseOver:c=>{c.currentTarget.style.backgroundColor=e.selectionBackground},onMouseOut:c=>{c.currentTarget.style.backgroundColor=e.statusBackground},children:"Restart Vim Editor"}),!1]})}return this.props.children}}const ke={name:"w",aliases:["write"],description:"Write (save) the current buffer",execute:async(r,e,t)=>{const o=r[0]||e.filename;if(!o)return{success:!1,message:"E32: No file name",messageType:"error"};try{const n=e.buffer.join(`
`);return await t.saveFile(o,n)?{success:!0,state:{...e,filename:o,isModified:!1,mode:"normal",commandInput:""},message:`"${o}" ${e.buffer.length}L, ${n.length}C written`,messageType:"info"}:{success:!1,message:`E212: Can't open file for writing: ${o}`,messageType:"error"}}catch(n){return{success:!1,message:`Write error: ${n instanceof Error?n.message:"Unknown error"}`,messageType:"error"}}}},nt={name:"q",aliases:["quit"],description:"Quit vim",execute:async(r,e,t)=>e.isModified?{success:!1,message:"E37: No write since last change (add ! to override)",messageType:"error"}:(t.exitVim(),{success:!0})},ot={name:"q!",aliases:["quit!"],description:"Force quit vim (discard changes)",execute:async(r,e,t)=>(t.exitVim(),{success:!0})},st={name:"wq",aliases:["x"],description:"Write and quit",execute:async(r,e,t)=>{const o=await ke.execute(r,e,t);return o.success?(t.exitVim(),{success:!0}):o}},it={name:"e",aliases:["edit"],description:"Edit a file",execute:async(r,e,t)=>{if(e.isModified)return{success:!1,message:"E37: No write since last change (add ! to override)",messageType:"error"};const o=r[0];if(!o)return{success:!1,message:"E471: Argument required",messageType:"error"};try{const n=await t.loadFile(o),s=n.split(`
`);return{success:!0,state:{...e,filename:o,buffer:s.length>0?s:[""],isModified:!1,cursor:{line:0,column:0},mode:"normal",commandInput:""},message:`"${o}" ${s.length}L, ${n.length}C`,messageType:"info"}}catch{return{success:!0,state:{...e,filename:o,buffer:[""],isModified:!1,cursor:{line:0,column:0},mode:"normal",commandInput:""},message:`"${o}" [New File]`,messageType:"info"}}}},ct={name:"set",aliases:["se"],description:"Set vim options",execute:async(r,e,t)=>{if(r.length===0)return{success:!1,message:"E471: Argument required",messageType:"error"};const o=r[0],n={...e};let s="";switch(o){case"number":case"nu":n.showLineNumbers=!0,s="Line numbers enabled";break;case"nonumber":case"nonu":n.showLineNumbers=!1,s="Line numbers disabled";break;default:return{success:!1,message:`E518: Unknown option: ${o}`,messageType:"error"}}return n.mode="normal",n.commandInput="",{success:!0,state:n,message:s,messageType:"info"}}},lt={name:"help",aliases:["h"],description:"Show help",execute:async(r,e,t)=>({success:!0,state:{...e,buffer:["=== Vim Help ===","","Normal Mode Commands:","  h, j, k, l    - Move cursor left, down, up, right","  w, b, e       - Word movements","  0, $          - Beginning/end of line","  gg, G         - First/last line","  i, a, o, O    - Enter insert mode","  x             - Delete character","  dd            - Delete line","  yy            - Yank (copy) line","  p, P          - Put (paste)","  u             - Undo","  Ctrl+r        - Redo","  /             - Search","  v             - Enter visual mode","  :             - Enter command mode","","Command Mode:","  :w            - Write (save) file","  :q            - Quit","  :wq           - Write and quit","  :q!           - Force quit","  :e <file>     - Edit file","  :set number   - Show line numbers","  :help         - Show this help","","Press : to enter command mode, then type a command."],filename:"[Help]",isModified:!1,cursor:{line:0,column:0},mode:"normal",commandInput:""},message:"Help loaded",messageType:"info"})},at=[ke,nt,ot,st,it,ct,lt],ut=r=>({mode:"normal",buffer:[""],cursor:{line:0,column:0},selection:void 0,isModified:!1,filename:r,commandInput:"",undoStack:[],redoStack:[],register:"",searchPattern:"",searchResults:[],currentSearchIndex:-1,message:"",messageType:"info",showLineNumbers:!0,scrollOffset:0,viewportHeight:25});function mt(r,e){const[t,o]=a.useState(()=>ut(r));a.useEffect(()=>{r&&e?.loadFile&&(async()=>{try{const f=await e.loadFile(r),b=f.split(`
`);o(d=>({...d,buffer:b.length>0?b:[""],isModified:!1,message:`"${r}" ${b.length}L, ${f.length}C`,messageType:"info"}))}catch{o(b=>({...b,buffer:[""],message:`"${r}" [New File]`,messageType:"info"}))}})()},[r,e]);const n=a.useCallback((g,f)=>{const b=[],d=Math.max(g.length,f.length);for(let w=0;w<d;w++){const h=g[w]||"",y=f[w]||"";h!==y&&(h===""&&y!==""?b.push({line:w,oldContent:"",newContent:y,operation:"insert"}):h!==""&&y===""?b.push({line:w,oldContent:h,newContent:"",operation:"delete"}):b.push({line:w,oldContent:h,newContent:y,operation:"replace"}))}return b},[]),s=a.useRef(void 0),c=a.useCallback((g,f="info")=>{o(b=>({...b,message:g,messageType:f})),s.current&&clearTimeout(s.current),f==="info"&&(s.current=setTimeout(()=>{o(b=>({...b,message:""}))},3e3))},[]);a.useEffect(()=>()=>{s.current&&clearTimeout(s.current)},[]);const i=a.useCallback(()=>{o(g=>({...g,mode:"normal",commandInput:"",selection:void 0}))},[]),l=a.useCallback(g=>{o(f=>({...f,mode:"insert",cursor:g||f.cursor}))},[]),u=a.useCallback(()=>{o(g=>({...g,mode:"visual",selection:{start:g.cursor,end:g.cursor}}))},[]),m=a.useCallback(()=>{o(g=>({...g,mode:"command",commandInput:""}))},[]),S=a.useCallback(g=>{o(f=>{if(!(f.buffer.length!==g.length||f.buffer.some((w,h)=>w!==g[h])))return f;const d={type:"buffer",data:{bufferDiffs:n(f.buffer,g),cursor:{...f.cursor},isModified:f.isModified},timestamp:Date.now()};return{...f,buffer:g,isModified:!0,undoStack:[...f.undoStack.slice(-19),d],redoStack:[]}})},[n]),L=a.useCallback(g=>{o(f=>{const b=Math.max(0,f.buffer.length-1),d=Math.max(0,Math.min(g.line,b)),w=f.buffer[d]?.length||0,h=Math.max(0,Math.min(g.column,w)),y={line:d,column:h};return f.cursor.line===y.line&&f.cursor.column===y.column&&f.mode==="visual"&&f.selection&&f.selection.end.line===y.line&&f.selection.end.column===y.column?f:f.mode==="visual"&&f.selection?{...f,cursor:y,selection:{...f.selection,end:y}}:{...f,cursor:y}})},[]),N=a.useCallback(async g=>{if(!g.trim())return{success:!1,message:"Empty command",messageType:"error"};const f=g.trim().split(/\s+/),b=f[0],d=f.slice(1),w=at.find(h=>h.name===b||h.aliases.includes(b));if(!w)return{success:!1,message:`E492: Not an editor command: ${b}`,messageType:"error"};try{const h=await w.execute(d,t,e||{});return h.state&&o(h.state),h.message&&c(h.message,h.messageType||"info"),h}catch(h){return{success:!1,message:`Command error: ${h instanceof Error?h.message:"Unknown error"}`,messageType:"error"}}},[t,e,c]),I=a.useCallback((g,f,b=!1)=>{const d=[...g];for(const w of f){const{line:h,oldContent:y,newContent:E}=w;if(b)h<d.length&&(d[h]=y);else if(h<d.length)d[h]=E;else{for(;d.length<=h;)d.push("");d[h]=E}}return d},[]),j=a.useCallback(()=>{o(g=>{if(g.undoStack.length===0)return c("Already at oldest change","warning"),g;const f=g.undoStack[g.undoStack.length-1],b=g.undoStack.slice(0,-1),d={type:f.type,data:{},timestamp:Date.now()};let w=g.buffer;if(f.type==="buffer"){if(f.data.bufferDiffs){w=I(g.buffer,f.data.bufferDiffs,!0);const E=n(w,g.buffer);d.data.bufferDiffs=E}else f.data.buffer&&(w=f.data.buffer,d.data.buffer=[...g.buffer]);d.data.cursor={...g.cursor},d.data.isModified=g.isModified}else f.type==="cursor"?d.data.cursor={...g.cursor}:f.type==="mode"&&(d.data.mode=g.mode,d.data.selection=g.selection?{...g.selection}:void 0);const h=[...g.redoStack,d],y={...g,buffer:w};return f.data.cursor&&(y.cursor=f.data.cursor),f.data.selection!==void 0&&(y.selection=f.data.selection),f.data.mode&&(y.mode=f.data.mode),f.data.isModified!==void 0&&(y.isModified=f.data.isModified),{...y,undoStack:b,redoStack:h,message:"",messageType:"info"}})},[c,I,n]),T=a.useCallback(()=>{o(g=>{if(g.redoStack.length===0)return c("Already at newest change","warning"),g;const f=g.redoStack[g.redoStack.length-1],b=g.redoStack.slice(0,-1),d={type:f.type,data:{},timestamp:Date.now()};f.type==="buffer"?(d.data.buffer=[...g.buffer],d.data.cursor={...g.cursor},d.data.isModified=g.isModified):f.type==="cursor"?d.data.cursor={...g.cursor}:f.type==="mode"&&(d.data.mode=g.mode,d.data.selection=g.selection?{...g.selection}:void 0);const w=[...g.undoStack,d],h={...g};return f.data.buffer&&(h.buffer=f.data.buffer),f.data.cursor&&(h.cursor=f.data.cursor),f.data.selection!==void 0&&(h.selection=f.data.selection),f.data.mode&&(h.mode=f.data.mode),f.data.isModified!==void 0&&(h.isModified=f.data.isModified),{...h,undoStack:w,redoStack:b,message:"",messageType:"info"}})},[c]),k=a.useCallback(g=>{o(f=>({...f,commandInput:g}))},[]),v=a.useCallback((g,f)=>{o(b=>f==="add"?{...b,commandInput:b.commandInput+g}:{...b,commandInput:b.commandInput.slice(0,-1)})},[]);return{state:t,enterNormalMode:i,enterInsertMode:l,enterVisualMode:u,enterCommandMode:m,updateBuffer:S,moveCursor:L,executeCommand:N,undo:j,redo:T,setMessage:c,updateCommandInput:k,handleCommandInputChange:v}}function dt(r){const e=[0];let t=!1;for(let o=0;o<r.length;o++){const n=r[o],s=/\w/.test(n);!t&&s?(e.push(o),t=!0):t&&!s&&(e.push(o),t=!1)}return e.push(r.length),[...new Set(e)].sort((o,n)=>o-n)}function te(r,e){const t=r.buffer[r.cursor.line]||"",o=dt(t);if(e==="forward"){const n=o.find(s=>s>r.cursor.column);if(n!==void 0)return{line:r.cursor.line,column:n};if(r.cursor.line<r.buffer.length-1)return{line:r.cursor.line+1,column:0}}else{const n=o.reverse().find(s=>s<r.cursor.column);if(n!==void 0)return{line:r.cursor.line,column:n};if(r.cursor.line>0){const s=r.buffer[r.cursor.line-1]||"";return{line:r.cursor.line-1,column:s.length}}}return r.cursor}function ft(r,e){const t=r.buffer[r.cursor.line]||"";if(r.cursor.column<t.length){const o=t.slice(0,r.cursor.column)+t.slice(r.cursor.column+1),n=[...r.buffer];n[r.cursor.line]=o,e.updateBuffer(n)}}function pt(r,e){if(r.buffer.length===1)e.updateBuffer([""]),e.moveCursor({line:0,column:0});else{const t=r.buffer.filter((s,c)=>c!==r.cursor.line);e.updateBuffer(t);const o=Math.min(r.cursor.line,t.length-1),n=Math.min(r.cursor.column,(t[o]||"").length);e.moveCursor({line:o,column:n})}}function ht(r,e){e.setMessage("1 line yanked","info")}function ge(r,e){e.setMessage("Nothing to put","warning")}function gt(r,e,t){const{key:o,ctrlKey:n}=r;if(n)switch(o){case"r":t.redo();return;case"f":const s=Math.min(e.buffer.length-1,e.cursor.line+e.viewportHeight);t.moveCursor({line:s,column:e.cursor.column});return;case"b":const c=Math.max(0,e.cursor.line-e.viewportHeight);t.moveCursor({line:c,column:e.cursor.column});return;default:return}switch(o){case"h":case"ArrowLeft":t.moveCursor({line:e.cursor.line,column:Math.max(0,e.cursor.column-1)});break;case"j":case"ArrowDown":if(e.cursor.line<e.buffer.length-1){const I=e.buffer[e.cursor.line+1]||"";t.moveCursor({line:e.cursor.line+1,column:Math.min(e.cursor.column,I.length)})}break;case"k":case"ArrowUp":if(e.cursor.line>0){const I=e.buffer[e.cursor.line-1]||"";t.moveCursor({line:e.cursor.line-1,column:Math.min(e.cursor.column,I.length)})}break;case"l":case"ArrowRight":const s=e.buffer[e.cursor.line]||"";e.cursor.column<s.length&&t.moveCursor({line:e.cursor.line,column:e.cursor.column+1});break;case"w":t.moveCursor(te(e,"forward"));break;case"b":t.moveCursor(te(e,"backward"));break;case"e":const c=te(e,"forward");c.column>0?t.moveCursor({...c,column:c.column-1}):t.moveCursor(c);break;case"0":case"Home":t.moveCursor({line:e.cursor.line,column:0});break;case"$":case"End":const i=(e.buffer[e.cursor.line]||"").length;t.moveCursor({line:e.cursor.line,column:Math.max(0,i-1)});break;case"g":t.moveCursor({line:0,column:0});break;case"G":const l=e.buffer.length-1,u=(e.buffer[l]||"").length;t.moveCursor({line:l,column:Math.max(0,u-1)});break;case"i":t.enterInsertMode();break;case"I":t.moveCursor({line:e.cursor.line,column:0}),t.enterInsertMode();break;case"a":const m=Math.min(e.cursor.column+1,(e.buffer[e.cursor.line]||"").length);t.enterInsertMode({line:e.cursor.line,column:m});break;case"A":const S=(e.buffer[e.cursor.line]||"").length;t.enterInsertMode({line:e.cursor.line,column:S});break;case"o":const L=[...e.buffer.slice(0,e.cursor.line+1),"",...e.buffer.slice(e.cursor.line+1)];t.updateBuffer(L),t.enterInsertMode({line:e.cursor.line+1,column:0});break;case"O":const N=[...e.buffer.slice(0,e.cursor.line),"",...e.buffer.slice(e.cursor.line)];t.updateBuffer(N),t.enterInsertMode({line:e.cursor.line,column:0});break;case"x":ft(e,t);break;case"d":pt(e,t);break;case"y":ht(e,t);break;case"p":ge(e,t);break;case"P":ge(e,t);break;case"u":t.undo();break;case"v":t.enterVisualMode();break;case":":t.enterCommandMode();break;case"/":t.setMessage("Search not implemented yet","info");break}}function ve(r,e,t){const o=r.buffer[r.cursor.line]||"",n=o.slice(0,r.cursor.column)+e+o.slice(r.cursor.column),s=[...r.buffer];s[r.cursor.line]=n,t.updateBuffer(s),t.moveCursor({line:r.cursor.line,column:r.cursor.column+1})}function re(r,e){if(r.cursor.column>0){const t=r.buffer[r.cursor.line]||"",o=t.slice(0,r.cursor.column-1)+t.slice(r.cursor.column),n=[...r.buffer];n[r.cursor.line]=o,e.updateBuffer(n),e.moveCursor({line:r.cursor.line,column:r.cursor.column-1})}else if(r.cursor.line>0){const t=r.buffer[r.cursor.line]||"",o=r.buffer[r.cursor.line-1]||"",n=o+t,s=[...r.buffer.slice(0,r.cursor.line-1),n,...r.buffer.slice(r.cursor.line+1)];e.updateBuffer(s),e.moveCursor({line:r.cursor.line-1,column:o.length})}}function yt(r,e){const t=r.buffer[r.cursor.line]||"";if(r.cursor.column<t.length){const o=t.slice(0,r.cursor.column)+t.slice(r.cursor.column+1),n=[...r.buffer];n[r.cursor.line]=o,e.updateBuffer(n)}else if(r.cursor.line<r.buffer.length-1){const o=r.buffer[r.cursor.line+1]||"",n=t+o,s=[...r.buffer.slice(0,r.cursor.line),n,...r.buffer.slice(r.cursor.line+2)];e.updateBuffer(s)}}function bt(r,e){const t=r.buffer[r.cursor.line]||"",o=t.slice(0,r.cursor.column),n=t.slice(r.cursor.column),s=[...r.buffer.slice(0,r.cursor.line),o,n,...r.buffer.slice(r.cursor.line+1)];e.updateBuffer(s),e.moveCursor({line:r.cursor.line+1,column:0})}function xt(r,e){ve(r,"  ",e)}function wt(r,e,t){const{key:o,ctrlKey:n,altKey:s,metaKey:c}=r;if(n&&!s&&!c)switch(o){case"c":t.enterNormalMode();return;case"h":re(e,t);return;case"w":re(e,t);return;case"u":{const l=(e.buffer[e.cursor.line]||"").slice(e.cursor.column),u=[...e.buffer];u[e.cursor.line]=l,t.updateBuffer(u),t.moveCursor({line:e.cursor.line,column:0});return}default:return}switch(o){case"Escape":t.enterNormalMode();break;case"Enter":bt(e,t);break;case"Backspace":re(e,t);break;case"Delete":yt(e,t);break;case"Tab":xt(e,t);break;case"ArrowLeft":if(e.cursor.column>0)t.moveCursor({line:e.cursor.line,column:e.cursor.column-1});else if(e.cursor.line>0){const i=e.buffer[e.cursor.line-1]||"";t.moveCursor({line:e.cursor.line-1,column:i.length})}break;case"ArrowRight":{const i=e.buffer[e.cursor.line]||"";e.cursor.column<i.length?t.moveCursor({line:e.cursor.line,column:e.cursor.column+1}):e.cursor.line<e.buffer.length-1&&t.moveCursor({line:e.cursor.line+1,column:0});break}case"ArrowUp":if(e.cursor.line>0){const i=e.buffer[e.cursor.line-1]||"";t.moveCursor({line:e.cursor.line-1,column:Math.min(e.cursor.column,i.length)})}break;case"ArrowDown":if(e.cursor.line<e.buffer.length-1){const i=e.buffer[e.cursor.line+1]||"";t.moveCursor({line:e.cursor.line+1,column:Math.min(e.cursor.column,i.length)})}break;case"Home":t.moveCursor({line:e.cursor.line,column:0});break;case"End":{const i=(e.buffer[e.cursor.line]||"").length;t.moveCursor({line:e.cursor.line,column:i});break}case"PageUp":{const i=Math.max(0,e.cursor.line-e.viewportHeight);t.moveCursor({line:i,column:e.cursor.column});break}case"PageDown":{const i=Math.min(e.buffer.length-1,e.cursor.line+e.viewportHeight);t.moveCursor({line:i,column:e.cursor.column});break}default:o.length===1&&!n&&!s&&!c&&ve(e,o,t);break}}function Ct(r){if(!r.selection)return"";const{start:e,end:t}=r.selection,o=e.line<t.line||e.line===t.line&&e.column<=t.column?e:t,n=e.line<t.line||e.line===t.line&&e.column<=t.column?t:e;if(o.line===n.line)return(r.buffer[o.line]||"").slice(o.column,n.column);const s=[];for(let c=o.line;c<=n.line;c++){const i=r.buffer[c]||"";c===o.line?s.push(i.slice(o.column)):c===n.line?s.push(i.slice(0,n.column)):s.push(i)}return s.join(`
`)}function St(r,e){if(!r.selection)return;const{start:t,end:o}=r.selection,n=t.line<o.line||t.line===o.line&&t.column<=o.column?t:o,s=t.line<o.line||t.line===o.line&&t.column<=o.column?o:t;if(n.line===s.line){const c=r.buffer[n.line]||"",i=c.slice(0,n.column)+c.slice(s.column),l=[...r.buffer];l[n.line]=i,e.updateBuffer(l),e.moveCursor(n)}else{const c=r.buffer[n.line]||"",i=r.buffer[s.line]||"",l=c.slice(0,n.column)+i.slice(s.column),u=[...r.buffer.slice(0,n.line),l,...r.buffer.slice(s.line+1)];e.updateBuffer(u),e.moveCursor(n)}e.enterNormalMode()}function kt(r,e){if(!r.selection)return;const o=Ct(r).split(`
`).length;e.setMessage(`${o} line${o===1?"":"s"} yanked`,"info"),e.enterNormalMode()}function vt(r){const e=[0];let t=!1;for(let o=0;o<r.length;o++){const n=r[o],s=/\w/.test(n);!t&&s?(e.push(o),t=!0):t&&!s&&(e.push(o),t=!1)}return e.push(r.length),[...new Set(e)].sort((o,n)=>o-n)}function ne(r,e){const t=r.buffer[r.cursor.line]||"",o=vt(t);if(e==="forward"){const n=o.find(s=>s>r.cursor.column);if(n!==void 0)return{line:r.cursor.line,column:n};if(r.cursor.line<r.buffer.length-1)return{line:r.cursor.line+1,column:0}}else{const n=o.reverse().find(s=>s<r.cursor.column);if(n!==void 0)return{line:r.cursor.line,column:n};if(r.cursor.line>0){const s=r.buffer[r.cursor.line-1]||"";return{line:r.cursor.line-1,column:s.length}}}return r.cursor}function $t(r,e,t){const{key:o,ctrlKey:n}=r;if(n)switch(o){case"f":const s=Math.min(e.buffer.length-1,e.cursor.line+e.viewportHeight);t.moveCursor({line:s,column:e.cursor.column});return;case"b":const c=Math.max(0,e.cursor.line-e.viewportHeight);t.moveCursor({line:c,column:e.cursor.column});return;default:return}switch(o){case"Escape":case"v":t.enterNormalMode();break;case"h":case"ArrowLeft":t.moveCursor({line:e.cursor.line,column:Math.max(0,e.cursor.column-1)});break;case"j":case"ArrowDown":if(e.cursor.line<e.buffer.length-1){const m=e.buffer[e.cursor.line+1]||"";t.moveCursor({line:e.cursor.line+1,column:Math.min(e.cursor.column,m.length)})}break;case"k":case"ArrowUp":if(e.cursor.line>0){const m=e.buffer[e.cursor.line-1]||"";t.moveCursor({line:e.cursor.line-1,column:Math.min(e.cursor.column,m.length)})}break;case"l":case"ArrowRight":const s=e.buffer[e.cursor.line]||"";e.cursor.column<s.length&&t.moveCursor({line:e.cursor.line,column:e.cursor.column+1});break;case"w":t.moveCursor(ne(e,"forward"));break;case"b":t.moveCursor(ne(e,"backward"));break;case"e":const c=ne(e,"forward");c.column>0?t.moveCursor({...c,column:c.column-1}):t.moveCursor(c);break;case"0":case"Home":t.moveCursor({line:e.cursor.line,column:0});break;case"$":case"End":const i=(e.buffer[e.cursor.line]||"").length;t.moveCursor({line:e.cursor.line,column:i});break;case"g":t.moveCursor({line:0,column:0});break;case"G":const l=e.buffer.length-1,u=(e.buffer[l]||"").length;t.moveCursor({line:l,column:u});break;case"d":case"x":St(e,t);break;case"y":kt(e,t);break;case"i":t.enterInsertMode();break;case":":t.enterCommandMode();break}}async function Mt(r,e){if(!r.commandInput.trim()){e.enterNormalMode();return}try{await e.executeCommand(r.commandInput)}catch(t){e.setMessage(`Command error: ${t instanceof Error?t.message:"Unknown error"}`,"error")}e.enterNormalMode()}function Dt(r,e,t){const{key:o,ctrlKey:n,altKey:s,metaKey:c}=r;if(n&&!s&&!c)switch(o){case"c":t.enterNormalMode();return;case"u":return;case"w":return;default:return}switch(o){case"Escape":t.enterNormalMode();break;case"Enter":Mt(e,t);break;case"Backspace":t.handleCommandInputChange("","delete");break;case"Delete":t.handleCommandInputChange("","delete");break;case"ArrowLeft":break;case"ArrowRight":break;case"ArrowUp":break;case"ArrowDown":break;case"Home":break;case"End":break;case"Tab":break;default:o.length===1&&!n&&!s&&!c&&t.handleCommandInputChange(o,"add");break}}function Lt(r,e){const t=a.useMemo(()=>r,[r.mode,r.cursor.line,r.cursor.column,r.buffer.length,r.commandInput,r.selection?.start.line,r.selection?.start.column,r.selection?.end.line,r.selection?.end.column]),o=a.useMemo(()=>e,[e.executeCommand,e.enterInsertMode,e.enterVisualMode,e.enterNormalMode,e.enterCommandMode,e.updateBuffer,e.moveCursor,e.undo,e.redo,e.setMessage,e.handleCommandInputChange]);return{handleKeyDown:a.useCallback(s=>{["F5","F11","F12"].includes(s.key)||s.preventDefault();try{switch(t.mode){case"normal":gt(s,t,o);break;case"insert":wt(s,t,o);break;case"visual":$t(s,t,o);break;case"command":Dt(s,t,o);break;default:console.warn(`Unknown vim mode: ${t.mode}`);break}}catch(i){console.error("Vim key handler error:",i),o.setMessage(`Key handler error: ${i instanceof Error?i.message:"Unknown error"}`,"error")}},[t,o])}}const Tt=({filename:r,currentDirectory:e,theme:t,onExit:o,onSaveFile:n,onLoadFile:s,onFileExists:c})=>{const i=a.useRef(null),l=a.useMemo(()=>({saveFile:n,loadFile:s,exitVim:o,fileExists:c,currentDirectory:e}),[n,s,o,c,e]),{state:u,executeCommand:m,enterInsertMode:S,enterVisualMode:L,enterNormalMode:N,enterCommandMode:I,updateBuffer:j,moveCursor:T,undo:k,redo:v,setMessage:g,handleCommandInputChange:f}=mt(r,l),b=a.useMemo(()=>({executeCommand:m,enterInsertMode:S,enterVisualMode:L,enterNormalMode:N,enterCommandMode:I,updateBuffer:j,moveCursor:T,undo:k,redo:v,setMessage:g,handleCommandInputChange:f}),[m,S,L,N,I,j,T,k,v,g,f]),d=()=>{window.gc&&typeof window.gc=="function"&&window.gc()},w=()=>({used:0,total:0,available:0}),{handleKeyDown:h}=Lt(u,b);a.useEffect(()=>{const x=i.current;if(!x)return;x.focus();const D=W=>{if(x.offsetParent!==null){W.ctrlKey&&["s","o","f","h","r","w","n","t"].includes(W.key)&&W.preventDefault();try{h(W)}catch(R){console.error("Vim key handler error:",R)}}};return x.addEventListener("keydown",D,{passive:!1}),()=>{x.removeEventListener("keydown",D)}},[h]);const y=a.useMemo(()=>({background:t.background,foreground:t.foreground,currentLineBackground:t.selection,lineNumber:t.comment,currentLineNumber:t.foreground,statusBackground:t.selection,statusForeground:t.foreground,selectionBackground:t.selection,searchHighlight:t.warning,cursor:t.cursor,syntax:{keyword:t.success,string:t.directory,comment:t.comment,number:t.warning,operator:t.foreground,identifier:t.foreground,type:t.success}}),[t]),E=a.useMemo(()=>({display:"flex",flexDirection:"column",height:"100%",width:"100%",backgroundColor:y.background,color:y.foreground,fontFamily:'Monaco, Menlo, "Ubuntu Mono", Consolas, "Courier New", monospace',fontSize:"14px",overflow:"hidden",position:"relative"}),[y.background,y.foreground]),F=a.useMemo(()=>({display:"flex",flex:1,overflow:"hidden"}),[]),$=a.useMemo(()=>({flexShrink:0}),[]),B=a.useMemo(()=>({flex:1,overflow:"hidden"}),[]),M=x=>{console.error("Vim Editor crashed:",x),g("Editor crashed - restarting in safe mode","error"),console.log("Memory usage at crash:",w()),d()};return p.jsx(rt,{theme:y,onError:M,children:p.jsxs("div",{ref:i,style:E,className:"vim-editor",tabIndex:0,role:"application","aria-label":"Vim Text Editor",children:[p.jsxs("div",{style:F,className:"vim-editor-area",children:[u.showLineNumbers&&p.jsx("div",{style:$,children:p.jsx(tt,{buffer:u.buffer,currentLine:u.cursor.line,scrollOffset:u.scrollOffset,viewportHeight:u.viewportHeight,theme:y})}),p.jsx("div",{style:B,children:p.jsx(et,{state:u,theme:y,onBufferChange:j})})]}),p.jsx(_e,{state:u,theme:y,filename:r,currentDirectory:e}),p.jsx("style",{children:`
        .vim-editor {
          font-variant-ligatures: none;
          -webkit-font-feature-settings: "liga" 0;
          font-feature-settings: "liga" 0;
        }
        
        .vim-editor:focus {
          outline: none;
        }
        
        .vim-cursor {
          animation: vim-blink 1s infinite;
          background-color: ${y.cursor};
          color: ${y.background};
        }
        
        .vim-current-line {
          background-color: ${y.currentLineBackground};
        }
        
        .vim-selection {
          background-color: ${y.selectionBackground};
        }
        
        .vim-search-highlight {
          background-color: ${y.searchHighlight};
          color: ${y.background};
        }
        
        @keyframes vim-blink {
          0%, 50% { opacity: 1; }
          51%, 100% { opacity: 0; }
        }
        
        /* Syntax highlighting */
        .vim-syntax-keyword { color: ${y.syntax.keyword}; font-weight: bold; }
        .vim-syntax-string { color: ${y.syntax.string}; }
        .vim-syntax-comment { color: ${y.syntax.comment}; font-style: italic; }
        .vim-syntax-number { color: ${y.syntax.number}; }
        .vim-syntax-operator { color: ${y.syntax.operator}; }
        .vim-syntax-identifier { color: ${y.syntax.identifier}; }
        .vim-syntax-type { color: ${y.syntax.type}; font-weight: bold; }
        
        /* Responsive design */
        @media (max-width: 768px) {
          .vim-editor {
            font-size: 12px;
          }
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
          .vim-editor {
            border: 2px solid ${y.foreground};
          }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
          .vim-cursor {
            animation: none;
            opacity: 1;
          }
        }
      `})]})})};class C{static convertToTerminalItem(e){return{name:e.name,isDirectory:e.type==="folder",path:e.path,permissions:"rwxr-xr-x",size:e.content?.length||0,modified:new Date}}static resolvePath(e,t){if(t.startsWith("/"))return this.normalizePath(t);if(t===".")return e;if(t===".."){const o=e.split("/").filter(Boolean);return o.pop(),`/${o.join("/")}`}if(t.startsWith("./")&&(t=t.substring(2)),t.startsWith("../")){const o=e.split("/").filter(Boolean),n=t.split("/");for(const s of n)s===".."?o.pop():s!=="."&&o.push(s);return`/${o.join("/")}`}return this.normalizePath(`${e}/${t}`)}static normalizePath(e){const t=e.split("/").filter(Boolean),o=[];for(const n of t)n!=="."&&(n===".."?o.pop():o.push(n));return`/${o.join("/")}`}static getParentDirectory(e){const t=e.split("/").filter(Boolean);return t.pop(),`/${t.join("/")}`}static getFilename(e){const t=e.split("/");return t[t.length-1]||""}static isSubdirectory(e,t){const o=this.normalizePath(e),n=this.normalizePath(t);return o===n?!1:n.startsWith(`${o}/`)}static findItemByPath(e,t){const o=this.normalizePath(t),n=s=>{for(const c of s){if(c.path===o)return c;if(c.children&&o.startsWith(`${c.path}/`)){const i=n(c.children);if(i)return i}}return null};return n(e)}static getDirectoryContents(e,t){const o=this.findItemByPath(e,t);return!o||o.type!=="folder"||!o.children?[]:o.children.map(n=>this.convertToTerminalItem(n))}static pathExists(e,t){return this.findItemByPath(e,t)!==null}static isDirectory(e,t){return this.findItemByPath(e,t)?.type==="folder"}static getFileContent(e,t){const o=this.findItemByPath(e,t);return!o||o.type!=="file"?null:o.content??""}static formatFileSize(e){if(e===0)return"0 B";const t=1024,o=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(e)/Math.log(t));return`${parseFloat((e/Math.pow(t,n)).toFixed(2))} ${o[n]}`}static formatPermissions(e){return e}static getFileExtension(e){const t=e.lastIndexOf(".");return t>0?e.substring(t+1).toLowerCase():""}static isExecutable(e){const t=this.getFileExtension(e);return["exe","bat","cmd","sh","py","js","rb","pl"].includes(t)}static getPathCompletions(e,t,o){let n=t,s=o;if(o.startsWith("/")){const i=o.lastIndexOf("/");n=o.substring(0,i)||"/",s=o.substring(i+1)}else if(o.includes("/")){const i=o.lastIndexOf("/"),l=o.substring(0,i);n=this.resolvePath(t,l),s=o.substring(i+1)}return this.getDirectoryContents(e,n).filter(i=>i.name.toLowerCase().startsWith(s.toLowerCase())).map(i=>{const l=i.isDirectory?`${i.name}/`:i.name;if(o.startsWith("/"))return n==="/"?`/${l}`:`${n}/${l}`;if(o.includes("/")){const u=o.lastIndexOf("/");return o.substring(0,u+1)+l}return l}).sort((i,l)=>{const u=i.endsWith("/"),m=l.endsWith("/");return u&&!m?-1:!u&&m?1:i.localeCompare(l)})}}const Et={name:"ls",aliases:["ll"],description:"List directory contents",usage:"ls [options] [directory]",execute:(r,e)=>{const t=$e(r),o=r.filter(i=>!i.startsWith("-")),n=o.length>0?C.resolvePath(e.currentDirectory,o[0]):e.currentDirectory;if(!C.pathExists(e.fileSystem,n))return{success:!1,output:"",error:`ls: cannot access '${o[0]||n}': No such file or directory`,type:"error"};if(!C.isDirectory(e.fileSystem,n))return{success:!0,output:C.getFilename(n),type:"output"};const s=C.getDirectoryContents(e.fileSystem,n);if(s.length===0)return{success:!0,output:"",type:"output"};if(t.l||t.long)return{success:!0,output:s.map(l=>{const u=l.isDirectory?"drwxr-xr-x":"-rw-r--r--",m=l.isDirectory?"4096":(l.size||0).toString(),S=l.modified?.toLocaleDateString()||new Date().toLocaleDateString(),L=l.isDirectory?U.colorize(l.name,"directory"):U.colorize(l.name,"file");return`${u} 1 ${e.username} ${e.username} ${m.padStart(8)} ${S} ${L}`}).join(`
`),type:"output"};const c=s.map(i=>({name:i.name,isDirectory:i.isDirectory,isExecutable:C.isExecutable(i.name)}));return{success:!0,output:U.formatFileList(c),type:"output"}},autocomplete:(r,e,t)=>C.getPathCompletions(t.fileSystem,t.currentDirectory,r)},It={name:"cd",aliases:[],description:"Change current directory",usage:"cd [directory]",execute:(r,e)=>{let t;return r.length===0?t="/Desktop":t=C.resolvePath(e.currentDirectory,r[0]),C.pathExists(e.fileSystem,t)?C.isDirectory(e.fileSystem,t)?{success:!0,output:"",newDirectory:t,type:"success"}:{success:!1,output:"",error:`cd: not a directory: ${r[0]}`,type:"error"}:{success:!1,output:"",error:`cd: no such file or directory: ${r[0]||"home"}`,type:"error"}},autocomplete:(r,e,t)=>C.getPathCompletions(t.fileSystem,t.currentDirectory,r).filter(o=>o.endsWith("/"))},jt={name:"pwd",aliases:[],description:"Print current working directory",usage:"pwd",execute:(r,e)=>({success:!0,output:e.currentDirectory,type:"output"})},Nt={name:"mkdir",aliases:[],description:"Create directories",usage:"mkdir [options] directory...",execute:(r,e)=>{if(r.length===0)return{success:!1,output:"",error:"mkdir: missing operand",type:"error"};const t=l=>!l||l.trim()===""?"Empty name not allowed":/[<>:"|?*\x00-\x1f]/.test(l)?"Name contains illegal characters":["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"].includes(l.toUpperCase())?"Reserved name not allowed":l.startsWith(".")||l.endsWith(".")||l.startsWith(" ")||l.endsWith(" ")?"Name cannot start or end with dots or spaces":null,o=r.filter(l=>!l.startsWith("-")),n=[],s=[];for(const l of o){const u=t(l);if(u){s.push(`mkdir: cannot create directory '${l}': ${u}`);continue}const m=C.resolvePath(e.currentDirectory,l),S=C.getParentDirectory(m),L=C.getFilename(m);if(!C.pathExists(e.fileSystem,S)){s.push(`mkdir: cannot create directory '${l}': No such file or directory`);continue}e.createFolder?e.createFolder(S,L)?n.push(l):s.push(`mkdir: cannot create directory '${l}': File exists or permission denied`):s.push(`mkdir: cannot create directory '${l}': Operation not supported`)}let c="";n.length>0&&(c+=`Created ${n.length} director${n.length===1?"y":"ies"}: ${n.join(", ")}`);let i="";return s.length>0&&(i=s.join(`
`)),{success:n.length>0,output:c,error:s.length>0?i:void 0,type:n.length>0?"success":"error"}}},Bt={name:"rmdir",aliases:[],description:"Remove empty directories",usage:"rmdir directory...",execute:(r,e)=>{if(r.length===0)return{success:!1,output:"",error:"rmdir: missing operand",type:"error"};const t=[],o=[];for(const c of r){const i=C.resolvePath(e.currentDirectory,c);if(!C.pathExists(e.fileSystem,i)){o.push(`rmdir: failed to remove '${c}': No such file or directory`);continue}if(!C.isDirectory(e.fileSystem,i)){o.push(`rmdir: failed to remove '${c}': Not a directory`);continue}if(C.getDirectoryContents(e.fileSystem,i).length>0){o.push(`rmdir: failed to remove '${c}': Directory not empty`);continue}e.removeFileSystemItem?e.removeFileSystemItem(i)?t.push(c):o.push(`rmdir: failed to remove '${c}': Permission denied`):o.push(`rmdir: failed to remove '${c}': Operation not supported`)}let n="",s="";return t.length>0&&(n=`Removed ${t.length} director${t.length===1?"y":"ies"}: ${t.join(", ")}`),o.length>0&&(s=o.join(`
`)),{success:t.length>0,output:n,error:o.length>0?s:void 0,type:t.length>0?"success":"error"}}},Ft={name:"touch",aliases:[],description:"Create empty files or update timestamps",usage:"touch file...",execute:(r,e)=>{if(r.length===0)return{success:!1,output:"",error:"touch: missing file operand",type:"error"};const t=i=>{if(!i||i.trim()==="")return"Empty name not allowed";if(/[<>:"|?*\x00-\x1f]/.test(i))return"Name contains illegal characters";const u=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],[m]=i.split(".");return u.includes(m.toUpperCase())?"Reserved name not allowed":i.startsWith(" ")||i.endsWith(" ")?"Name cannot start or end with spaces":null},o=[],n=[];for(const i of r){const l=t(i);if(l){n.push(`touch: cannot create file '${i}': ${l}`);continue}const u=C.resolvePath(e.currentDirectory,i),m=C.getParentDirectory(u),S=C.getFilename(u);if(!C.pathExists(e.fileSystem,m)){n.push(`touch: cannot create file '${i}': No such file or directory`);continue}e.createFile?e.createFile(m,S,"")?o.push(i):n.push(`touch: cannot create file '${i}': File exists or permission denied`):n.push(`touch: cannot create file '${i}': Operation not supported`)}let s="";o.length>0&&(s+=`Created/updated ${o.length} file${o.length===1?"":"s"}: ${o.join(", ")}`);let c="";return n.length>0&&(c=n.join(`
`)),{success:o.length>0,output:s,error:n.length>0?c:void 0,type:o.length>0?"success":"error"}}},Pt={name:"rm",aliases:[],description:"Remove files and directories",usage:"rm [options] file...",execute:(r,e)=>{if(r.length===0)return{success:!1,output:"",error:"rm: missing operand",type:"error"};const t=$e(r),o=r.filter(l=>!l.startsWith("-")),n=[],s=[];for(const l of o){const u=C.resolvePath(e.currentDirectory,l);if(!C.pathExists(e.fileSystem,u)){!t.f&&!t.force&&s.push(`rm: cannot remove '${l}': No such file or directory`);continue}if(C.isDirectory(e.fileSystem,u)&&!t.r&&!t.recursive){!t.f&&!t.force&&s.push(`rm: cannot remove '${l}': Is a directory`);continue}C.isDirectory(e.fileSystem,u)&&(t.r||t.recursive)&&C.getDirectoryContents(e.fileSystem,u).length>0&&!t.f&&t.force,e.removeFileSystemItem?e.removeFileSystemItem(u)?n.push(l):!t.f&&!t.force&&s.push(`rm: cannot remove '${l}': Permission denied`):!t.f&&!t.force&&s.push(`rm: cannot remove '${l}': Operation not supported`)}let c="",i="";return n.length>0&&(c=`Removed ${n.length} item${n.length===1?"":"s"}: ${n.join(", ")}`),s.length>0&&(i=s.join(`
`)),{success:n.length>0,output:c,error:s.length>0?i:void 0,type:n.length>0?"success":"error"}}},Rt={name:"cp",aliases:[],description:"Copy files or directories",usage:"cp [options] source destination",execute:(r,e)=>{if(r.length<2)return{success:!1,output:"",error:"cp: missing destination file operand",type:"error"};const t=r[r.length-2],o=r[r.length-1],n=C.resolvePath(e.currentDirectory,t);if(!C.pathExists(e.fileSystem,n))return{success:!1,output:"",error:`cp: cannot stat '${t}': No such file or directory`,type:"error"};if(C.isDirectory(e.fileSystem,n))return{success:!1,output:"",error:`cp: -r not specified; omitting directory '${t}'`,type:"error"};const s=C.getFileContent(e.fileSystem,n);if(s===null)return{success:!1,output:"",error:`cp: cannot open '${t}' for reading: Permission denied`,type:"error"};let c,i;return o.includes("/")||o==="."?(c=C.resolvePath(e.currentDirectory,o),C.pathExists(e.fileSystem,c)&&C.isDirectory(e.fileSystem,c)?i=C.getFilename(n):(i=C.getFilename(c),c=C.getParentDirectory(c))):(c=e.currentDirectory,i=o),C.pathExists(e.fileSystem,c)?e.createFile?e.createFile(c,i,s)?{success:!0,output:`Copied '${t}' to '${o}'`,type:"success"}:{success:!1,output:"",error:`cp: cannot create regular file '${o}': File exists or permission denied`,type:"error"}:{success:!1,output:"",error:"cp: Operation not supported",type:"error"}:{success:!1,output:"",error:`cp: cannot create regular file '${o}': No such file or directory`,type:"error"}}},Ht={name:"mv",aliases:[],description:"Move/rename files or directories",usage:"mv source destination",execute:(r,e)=>{if(r.length<2)return{success:!1,output:"",error:"mv: missing destination file operand",type:"error"};const[t,o]=r,n=C.resolvePath(e.currentDirectory,t);if(!C.pathExists(e.fileSystem,n))return{success:!1,output:"",error:`mv: cannot stat '${t}': No such file or directory`,type:"error"};let s="";const c=C.isDirectory(e.fileSystem,n);if(!c){const m=C.getFileContent(e.fileSystem,n);if(m===null)return{success:!1,output:"",error:`mv: cannot open '${t}' for reading: Permission denied`,type:"error"};s=m}let i,l;if(o.includes("/")||o==="."?(i=C.resolvePath(e.currentDirectory,o),C.pathExists(e.fileSystem,i)&&C.isDirectory(e.fileSystem,i)?l=C.getFilename(n):(l=C.getFilename(i),i=C.getParentDirectory(i))):(i=e.currentDirectory,l=o),!C.pathExists(e.fileSystem,i))return{success:!1,output:"",error:`mv: cannot move '${t}' to '${o}': No such file or directory`,type:"error"};let u=!1;if(c?e.createFolder&&(u=e.createFolder(i,l)):e.createFile&&(u=e.createFile(i,l,s)),!u)return{success:!1,output:"",error:`mv: cannot create '${o}': File exists or permission denied`,type:"error"};if(e.removeFileSystemItem){if(!e.removeFileSystemItem(n))return{success:!1,output:"",error:`mv: cannot remove '${t}': Permission denied`,type:"error"}}else return{success:!1,output:"",error:"mv: Operation not supported",type:"error"};return{success:!0,output:`Moved '${t}' to '${o}'`,type:"success"}}},At={name:"cat",aliases:[],description:"Display file contents",usage:"cat file...",execute:(r,e)=>{if(r.length===0)return{success:!1,output:"",error:"cat: missing file operand",type:"error"};const t=[];for(const o of r){const n=C.resolvePath(e.currentDirectory,o);if(!C.pathExists(e.fileSystem,n)){t.push(`cat: ${o}: No such file or directory`);continue}if(C.isDirectory(e.fileSystem,n)){t.push(`cat: ${o}: Is a directory`);continue}const s=C.getFileContent(e.fileSystem,n);s!==null?t.push(s):t.push(`cat: ${o}: Permission denied`)}return{success:!0,output:t.join(`
`),type:"output"}},autocomplete:(r,e,t)=>C.getPathCompletions(t.fileSystem,t.currentDirectory,r).filter(o=>!o.endsWith("/"))},Wt={name:"grep",aliases:[],description:"Search text patterns in files",usage:"grep [options] pattern [file...]",execute:(r,e)=>{if(r.length===0)return{success:!1,output:"",error:"grep: missing pattern",type:"error"};const[t]=r,o=r.slice(1);if(o.length===0)return{success:!0,output:`Searching for pattern '${t}' in standard input...`,type:"output"};const n=[];for(const s of o){const c=C.resolvePath(e.currentDirectory,s),i=C.getFileContent(e.fileSystem,c);if(i){const u=i.split(`
`).filter(m=>m.includes(t));u.length>0&&(n.push(`${s}:`),n.push(...u.map(m=>`  ${m}`)))}}return{success:!0,output:n.length>0?n.join(`
`):`No matches found for '${t}'`,type:"output"}}},zt={name:"find",aliases:[],description:"Search for files and directories",usage:"find [path] [options]",execute:(r,e)=>{const t=r.length>0&&!r[0].startsWith("-")?r[0]:e.currentDirectory,o=r.find((s,c)=>r[c-1]==="-name");return o?{success:!0,output:[`${t}/example1.txt`,`${t}/subfolder/example2.txt`,`${t}/documents/readme.md`].filter(s=>s.includes(o)).join(`
`),type:"output"}:{success:!0,output:`Searching in ${t}...`,type:"output"}}};function $e(r){const e={};return r.forEach(t=>{t.startsWith("--")?e[t.substring(2)]=!0:t.startsWith("-")&&t.substring(1).split("").forEach(o=>{e[o]=!0})}),e}const Ot=[Et,It,jt,Nt,Bt,Ft,Pt,Rt,Ht,At,Wt,zt],Vt={name:"dir",aliases:[],description:"Display directory contents",usage:"dir [path]",execute:(r,e)=>{const t=r.length>0?C.resolvePath(e.currentDirectory,r[0]):e.currentDirectory;if(!C.pathExists(e.fileSystem,t))return{success:!1,output:"",error:"The system cannot find the path specified.",type:"error"};if(!C.isDirectory(e.fileSystem,t))return{success:!0,output:C.getFilename(t),type:"output"};const o=C.getDirectoryContents(e.fileSystem,t);if(o.length===0)return{success:!0,output:"Directory is empty.",type:"output"};const n=[" Volume in drive C has no label."," Volume Serial Number is 1234-5678","",` Directory of ${t}`,""],s=o.map(m=>{const S=m.modified?.toLocaleDateString("en-US")||new Date().toLocaleDateString("en-US"),L=m.modified?.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})||"00:00",N=m.isDirectory?"<DIR>":(m.size||0).toString().padStart(15),I=m.isDirectory?U.colorize(m.name,"directory"):U.colorize(m.name,"file");return`${S}  ${L}    ${N} ${I}`}),c=o.filter(m=>!m.isDirectory).length,i=o.filter(m=>m.isDirectory).length,l=o.reduce((m,S)=>m+(S.size||0),0),u=["",`               ${c} File(s)  ${l.toLocaleString()} bytes`,`               ${i} Dir(s)   999,999,999 bytes free`];return{success:!0,output:[...n,...s,...u].join(`
`),type:"output"}},autocomplete:(r,e,t)=>C.getPathCompletions(t.fileSystem,t.currentDirectory,r)},Kt={name:"cd",aliases:["chdir"],description:"Change current directory",usage:"cd [directory]",execute:(r,e)=>{if(r.length===0)return{success:!0,output:e.currentDirectory,type:"output"};const t=C.resolvePath(e.currentDirectory,r[0]);return C.pathExists(e.fileSystem,t)?C.isDirectory(e.fileSystem,t)?{success:!0,output:"",newDirectory:t,type:"success"}:{success:!1,output:"",error:"The directory name is invalid.",type:"error"}:{success:!1,output:"",error:"The system cannot find the path specified.",type:"error"}},autocomplete:(r,e,t)=>C.getPathCompletions(t.fileSystem,t.currentDirectory,r).filter(o=>o.endsWith("/"))},Ut={name:"md",aliases:["mkdir"],description:"Create directories",usage:"md directory",execute:(r,e)=>{if(r.length===0)return{success:!1,output:"",error:"The syntax of the command is incorrect.",type:"error"};const t=[],o=[];for(const c of r)e.createFolder&&e.createFolder(e.currentDirectory,c)?t.push(c):o.push(c);let n="";t.length>0&&(n+=t.map(c=>`Directory created: ${c}`).join(`
`));let s="";return o.length>0&&(s=`A subdirectory or file ${o.join(", ")} already exists.`),{success:t.length>0,output:n,error:o.length>0?s:void 0,type:t.length>0?"success":"error"}}},_t={name:"rd",aliases:["rmdir"],description:"Remove directories",usage:"rd directory",execute:r=>r.length===0?{success:!1,output:"",error:"The syntax of the command is incorrect.",type:"error"}:{success:!0,output:`Directory removed: ${r[0]}`,type:"success"}},qt={name:"del",aliases:["erase"],description:"Delete files",usage:"del filename",execute:r=>{if(r.length===0)return{success:!1,output:"",error:"The syntax of the command is incorrect.",type:"error"};const e=r.filter(t=>!t.startsWith("/"));return{success:!0,output:`Deleted ${e.length} file${e.length===1?"":"s"}.`,type:"success"}}},Gt={name:"copy",aliases:[],description:"Copy files",usage:"copy source destination",execute:r=>{if(r.length<2)return{success:!1,output:"",error:"The syntax of the command is incorrect.",type:"error"};const[e,t]=r;return{success:!0,output:`        1 file(s) copied.
        ${e} -> ${t}`,type:"success"}}},Yt={name:"move",aliases:[],description:"Move files and directories",usage:"move source destination",execute:r=>{if(r.length<2)return{success:!1,output:"",error:"The syntax of the command is incorrect.",type:"error"};const[e,t]=r;return{success:!0,output:`        1 file(s) moved.
        ${e} -> ${t}`,type:"success"}}},Qt={name:"type",aliases:[],description:"Display file contents",usage:"type filename",execute:(r,e)=>{if(r.length===0)return{success:!1,output:"",error:"The syntax of the command is incorrect.",type:"error"};const[t]=r,o=C.resolvePath(e.currentDirectory,t);if(!C.pathExists(e.fileSystem,o))return{success:!1,output:"",error:"The system cannot find the file specified.",type:"error"};if(C.isDirectory(e.fileSystem,o))return{success:!1,output:"",error:"Access is denied.",type:"error"};const n=C.getFileContent(e.fileSystem,o);return n!==null?{success:!0,output:n,type:"output"}:{success:!1,output:"",error:"Access is denied.",type:"error"}},autocomplete:(r,e,t)=>C.getPathCompletions(t.fileSystem,t.currentDirectory,r).filter(o=>!o.endsWith("/"))},Jt={name:"attrib",aliases:[],description:"Display or change file attributes",usage:"attrib [+R | -R] [+A | -A] [+S | -S] [+H | -H] [filename]",execute:(r,e)=>{if(r.length===0)return{success:!0,output:C.getDirectoryContents(e.fileSystem,e.currentDirectory).map(c=>`${c.isDirectory?"    ":"A   "} ${c.path}`).join(`
`),type:"output"};const t=r[r.length-1];return{success:!0,output:`Attributes ${r.slice(0,-1).join(" ")} set for ${t}`,type:"success"}}},Zt={name:"ver",aliases:[],description:"Display system version",usage:"ver",execute:()=>({success:!0,output:"Portfolio Desktop OS [Version 1.0.0]",type:"output"})},Xt={name:"time",aliases:[],description:"Display or set system time",usage:"time [new-time]",execute:r=>r.length===0?{success:!0,output:`The current time is: ${new Date().toLocaleTimeString()}`,type:"output"}:{success:!0,output:`Time set to: ${r[0]}`,type:"success"}},er={name:"findstr",aliases:[],description:"Search for text in files",usage:"findstr [options] string [filename]",execute:(r,e)=>{if(r.length===0)return{success:!1,output:"",error:"The syntax of the command is incorrect.",type:"error"};const[t]=r,o=r.slice(1);if(o.length===0)return{success:!0,output:`Searching for "${t}" in standard input...`,type:"output"};const n=[];for(const s of o){const c=C.resolvePath(e.currentDirectory,s),i=C.getFileContent(e.fileSystem,c);i&&i.split(`
`).forEach((u,m)=>{u.includes(t)&&n.push(`${s}:${m+1}:${u}`)})}return{success:!0,output:n.length>0?n.join(`
`):"String not found.",type:"output"}}},tr={name:"ipconfig",aliases:[],description:"Display network configuration",usage:"ipconfig [options]",execute:r=>r.includes("/all")?{success:!0,output:["Windows IP Configuration","","   Host Name . . . . . . . . . . . . : portfolio-desktop","   Primary Dns Suffix  . . . . . . . : ","   Node Type . . . . . . . . . . . . : Hybrid","   IP Routing Enabled. . . . . . . . : No","   WINS Proxy Enabled. . . . . . . . : No","","Ethernet adapter Local Area Connection:","","   Connection-specific DNS Suffix  . : ","   Description . . . . . . . . . . . : Intel(R) Ethernet Connection","   Physical Address. . . . . . . . . : 00-1B-21-12-34-56","   DHCP Enabled. . . . . . . . . . . : Yes","   Autoconfiguration Enabled . . . . : Yes","   IPv4 Address. . . . . . . . . . . : 192.168.1.100(Preferred)","   Subnet Mask . . . . . . . . . . . : 255.255.255.0","   Default Gateway . . . . . . . . . : 192.168.1.1","   DHCP Server . . . . . . . . . . . : 192.168.1.1","   DNS Servers . . . . . . . . . . . : 8.8.8.8","                                       8.8.4.4"].join(`
`),type:"output"}:{success:!0,output:["Windows IP Configuration","","Ethernet adapter Local Area Connection:","","   Connection-specific DNS Suffix  . : ","   IPv4 Address. . . . . . . . . . . : 192.168.1.100","   Subnet Mask . . . . . . . . . . . : 255.255.255.0","   Default Gateway . . . . . . . . . : 192.168.1.1"].join(`
`),type:"output"}},rr={name:"nslookup",aliases:[],description:"Query DNS servers",usage:"nslookup [hostname]",execute:async r=>{if(r.length===0)return{success:!0,output:["Default Server:  dns.google","Address:  8.8.8.8","",">"].join(`
`),type:"output"};const[e]=r;return await new Promise(t=>setTimeout(t,500)),{success:!0,output:["Server:  dns.google","Address:  8.8.8.8","",`Name:    ${e}`,"Address:  93.184.216.34"].join(`
`),type:"output"}}},nr=[Vt,Kt,Ut,_t,qt,Gt,Yt,Qt,Jt,Zt,Xt,er,tr,rr],Me=r=>new Promise(e=>setTimeout(e,r)),or=async r=>{await Me(Math.random()*500+200);const e=Math.random()>.1,t=Math.floor(Math.random()*100)+10;return e?{success:!0,data:`PING ${r}: 64 bytes from ${r}: icmp_seq=1 ttl=64 time=${t} ms`,responseTime:t}:{success:!1,data:`ping: cannot resolve ${r}: Unknown host`,responseTime:0,error:"Host unreachable"}},se={name:"clear",aliases:["cls"],description:"Clear the terminal screen",usage:"clear",execute:()=>({success:!0,output:"",clear:!0,type:"success"})},ie={name:"exit",aliases:["quit"],description:"Exit the terminal",usage:"exit",execute:()=>({success:!0,output:"Goodbye!",exit:!0,type:"info"})},ce={name:"help",aliases:["?"],description:"Display available commands",usage:"help [command]",execute:(r,e)=>{const t=e.osType==="windows";if(r.length>0)return{success:!0,output:sr(r[0]),type:"info"};const o=t?je():Ie();return{success:!0,output:[U.colorize("Available Commands:","info"),"",...o.map(s=>`  ${U.colorize(s.name.padEnd(12),"success")} ${s.description}`),"",'Type "help <command>" for more information about a specific command.',`Current OS: ${U.colorize(t?"Windows":"Linux","warning")}`].join(`
`),type:"info"}}},le={name:"echo",aliases:[],description:"Display text",usage:"echo [text...]",execute:r=>({success:!0,output:r.join(" "),type:"output"})},ae={name:"date",aliases:[],description:"Display current date and time",usage:"date",execute:()=>({success:!0,output:new Date().toString(),type:"output"})},ue={name:"whoami",aliases:[],description:"Display current username",usage:"whoami",execute:(r,e)=>({success:!0,output:e.username,type:"output"})},me={name:"ping",aliases:[],description:"Send ICMP echo requests to a host",usage:"ping <host>",execute:async r=>{if(r.length===0)return{success:!1,output:"",error:"ping: missing host argument",type:"error"};const[e]=r,t=[];t.push(`PING ${e} (${e}): 56 data bytes`);for(let o=1;o<=4;o++){const n=await or(e);if(n.success)t.push(n.data.replace("icmp_seq=1",`icmp_seq=${o}`));else{t.push(n.data);break}}return{success:!0,output:t.join(`
`),type:"output"}}},De={name:"curl",aliases:[],description:"Transfer data from servers",usage:"curl <url>",execute:async r=>{if(r.length===0)return{success:!1,output:"",error:"curl: no URL specified",type:"error"};const[e]=r;return await Me(1e3),Math.random()>.2?{success:!0,output:`HTTP/1.1 200 OK
Content-Type: text/html

<!DOCTYPE html>
<html>
<head><title>Example</title></head>
<body><h1>Hello World!</h1></body>
</html>`,type:"output"}:{success:!1,output:"",error:`curl: (6) Could not resolve host: ${e}`,type:"error"}}},Le={name:"ps",aliases:[],description:"Display running processes",usage:"ps [options]",execute:()=>{const r=[{pid:1,name:"init",cpu:0,memory:"1.2M",state:"S",startTime:"00:00"},{pid:123,name:"terminal",cpu:2.5,memory:"15.4M",state:"R",startTime:"10:30"},{pid:456,name:"browser",cpu:5.2,memory:"128.7M",state:"S",startTime:"09:15"},{pid:789,name:"editor",cpu:1.8,memory:"45.3M",state:"S",startTime:"11:20"}],e="PID     NAME        CPU%   MEM     STATE  START",t=r.map(o=>`${o.pid.toString().padEnd(8)}${o.name.padEnd(12)}${o.cpu.toFixed(1).padEnd(7)}${o.memory.padEnd(8)}${o.state.padEnd(7)}${o.startTime}`);return{success:!0,output:[e,...t].join(`
`),type:"output"}}},Te={name:"uptime",aliases:[],description:"Show system uptime and load",usage:"uptime",execute:()=>({success:!0,output:`${new Date().toLocaleTimeString()} up 2 days, 14:32, 1 user, load average: 0.15, 0.23, 0.18`,type:"output"})},Ee={name:"uname",aliases:[],description:"Display system information",usage:"uname [-a]",execute:r=>{const e={os:"Portfolio-OS",version:"1.0.0",arch:"x86_64",hostname:"thalison",datetime:new Date().toISOString()};return r.includes("-a")||r.includes("--all")?{success:!0,output:`${e.os} ${e.hostname} ${e.version} ${e.arch}`,type:"output"}:{success:!0,output:e.os,type:"output"}}};function sr(r,e){const o=[...Ie(),...je()].find(n=>n.name===r||n.aliases.includes(r));return o?[U.colorize(`${o.name}`,"success"),`Description: ${o.description}`,`Usage: ${o.usage}`,o.aliases.length>0?`Aliases: ${o.aliases.join(", ")}`:""].filter(Boolean).join(`
`):`Command '${r}' not found.`}function Ie(){return[se,ie,ce,le,ae,ue,me,De,Le,Te,Ee]}function je(){return[se,ie,ce,le,ae,ue,me]}const ir={name:"vim",aliases:["vi"],description:"Open vim text editor (LunarVim-inspired)",usage:"vim [filename]",execute:async(r,e)=>{const t=r[0];return t&&(t.includes("..")||t.startsWith("/"))?{success:!1,output:"",error:`vim: "${t}": Invalid filename`,type:"error"}:{success:!0,output:"",type:"vim",vimData:{filename:t,currentDirectory:e.currentDirectory}}},autocomplete:(r,e,t)=>{if(e.length<=1)try{return(t.fileSystem||[]).filter(n=>!n.isFolder&&n.name.startsWith(r)).map(n=>n.name).slice(0,10)}catch{return[]}return[]}};class cr{commands=new Map;aliases=new Map;constructor(e){this.initializeCommands(e)}initializeCommands(e){this.commands.clear(),this.aliases.clear();const t=[se,ie,ce,le,ae,ue,me],o=e==="linux"?[...Ot,De,Le,Te,Ee]:nr;[...t,...o,ir].forEach(n=>{this.commands.set(n.name,n),n.aliases.forEach(s=>{this.aliases.set(s,n.name)})})}getCommand(e){const t=this.aliases.get(e);return t?this.commands.get(t):this.commands.get(e)}getAllCommands(){return Array.from(this.commands.values())}getCommandSuggestions(e){const t=[];return this.commands.forEach((o,n)=>{n.startsWith(e.toLowerCase())&&t.push(n)}),this.aliases.forEach((o,n)=>{n.startsWith(e.toLowerCase())&&t.push(n)}),t.sort()}hasCommand(e){return this.commands.has(e)||this.aliases.has(e)}getArgumentSuggestions(e,t,o,n){const s=this.getCommand(e);if(!s||!s.autocomplete)return[];try{return s.autocomplete(t,o,n)}catch(c){return console.warn(`Autocomplete error for command ${e}:`,c),[]}}switchOS(e){this.initializeCommands(e)}getCommandUsage(e){return this.getCommand(e)?.usage}getCommandDescription(e){return this.getCommand(e)?.description}getAllCommandNames(){const e=Array.from(this.commands.keys()),t=Array.from(this.aliases.keys());return[...e,...t]}}function ye(r){return new cr(r)}class Ne{static parse(e){const t=e.trim();if(!t)return{command:"",args:[],raw:e,flags:{}};const o=this.tokenize(t);if(o.length===0)return{command:"",args:[],raw:e,flags:{}};const n=o[0],s=o.slice(1),c=[],i={};for(let l=0;l<s.length;l++){const u=s[l];if(u.startsWith("--")){const[m,...S]=u.substring(2).split("=");S.length>0?i[m]=S.join("="):l+1<s.length&&!s[l+1].startsWith("-")?(i[m]=s[l+1],l++):i[m]=!0}else if(u.startsWith("-")&&u.length>1){const m=u.substring(1);for(let S=0;S<m.length;S++){const L=m[S];S===m.length-1&&l+1<s.length&&!s[l+1].startsWith("-")?(i[L]=s[l+1],l++):i[L]=!0}}else c.push(u)}return{command:n,args:c,raw:e,flags:i}}static tokenize(e){const t=[];let o="",n=!1,s="",c=!1;for(let i=0;i<e.length;i++){const l=e[i];if(c){o+=l,c=!1;continue}if(l==="\\"){c=!0;continue}if((l==='"'||l==="'")&&!n){n=!0,s=l;continue}if(l===s&&n){n=!1,s="";continue}if(l===" "&&!n){o&&(t.push(o),o="");continue}o+=l}return o&&t.push(o),t}static escape(e){return e.replace(/[\\'"$`]/g,"\\$&")}static needsQuoting(e){return/[\s'"$`\\]/.test(e)}static quote(e){return this.needsQuoting(e)?`"${e.replace(/["\\]/g,"\\$&")}"`:e}}const lr=15;function ar(r,e=lr){const[t,o]=a.useState([]),[n,s]=a.useState(-1),c=k=>`terminal-command-history-${k}`;a.useEffect(()=>{try{const k=c(r),v=localStorage.getItem(k);if(v){const g=JSON.parse(v);Array.isArray(g)&&o(g.slice(-e))}else o([]);s(-1)}catch(k){console.warn("Failed to load command history from localStorage:",k)}},[e,r]),a.useEffect(()=>{try{const k=c(r);localStorage.setItem(k,JSON.stringify(t))}catch(k){console.warn("Failed to save command history to localStorage:",k)}},[t,r]);const i=a.useCallback(k=>{const v=k.trim();v&&(o(g=>[...g,v].slice(-e)),s(-1))},[e]),l=a.useCallback(k=>{if(t.length===0)return null;let v;if(k==="up")n===-1?v=t.length-1:n>0?v=n-1:v=0;else{if(n===-1)return null;n<t.length-1?v=n+1:v=-1}return s(v),v===-1?"":t[v]},[t,n]),u=a.useCallback(k=>{if(!k.trim())return t;const v=k.toLowerCase();return t.filter(g=>g.toLowerCase().includes(v)).slice(-20)},[t]),m=a.useCallback(()=>n===-1||n>=t.length?null:t[n],[t,n]),S=a.useCallback(()=>{s(-1)},[]),L=a.useCallback(()=>{o([]),s(-1);try{const k=c(r);localStorage.removeItem(k)}catch(k){console.warn("Failed to clear command history from localStorage:",k)}},[r]),N=a.useCallback((k=10)=>t.slice(-k),[t]),I=t.length>0,j=n<t.length-1||n===-1,T=n>0;return{history:t,historyIndex:n,addToHistory:i,navigateHistory:l,searchHistory:u,getCurrentHistoryEntry:m,resetHistoryIndex:S,clearHistory:L,getRecentCommands:N,hasHistory:I,canNavigateUp:j,canNavigateDown:T}}function ur(r,e,t,o){const[n,s]=a.useState([]),[c,i]=a.useState(-1),[l,u]=a.useState(!1),m=a.useCallback((d,w)=>{const h=d.trim();if(!h)return{completions:[],commonPrefix:"",hasExactMatch:!1};Ne.parse(h);const y=h.split(/\s+/),E=Math.max(0,h.substring(0,w).split(/\s+/).length-1),F=y[E]||"";let $=[],B="";if(E===0)$=r.getCommandSuggestions(F),B=be($);else{const[x]=y,D=y.slice(1,E);try{$=r.getArgumentSuggestions(x,F,D,{currentDirectory:e,fileSystem:t,osType:o,env:{},history:[],username:"user",hostname:"desktop"}),B=be($)}catch(W){console.warn("Error generating argument suggestions:",W),$=[]}}const M=$.includes(F);return{completions:$.slice(0,20),commonPrefix:B,hasExactMatch:M}},[r,e,t,o]),S=a.useCallback((d,w)=>{const h=m(d,w),y=d.trim(),E=y.split(/\s+/),F=Math.max(0,y.substring(0,w).split(/\s+/).length-1),$=E[F]||"",B=h.completions.length===0||$&&h.completions.includes($)||$&&h.completions.every(M=>$.length>=M.length);return s(h.completions),i(-1),u(!B&&h.completions.length>0),h},[m]),L=a.useCallback(d=>{if(n.length===0)return null;let w;return d==="up"?w=c<=0?n.length-1:c-1:w=c>=n.length-1?0:c+1,i(w),n[w]},[n,c]),N=a.useCallback(d=>d<0||d>=n.length?null:(i(d),n[d]),[n]),I=a.useCallback(()=>c<0||c>=n.length?null:n[c],[n,c]),j=a.useCallback((d,w,h)=>{const y=h||I();if(!y)return{newInput:d,newCursorPosition:w};const E=d.split(/\s+/),F=d.substring(0,w),$=Math.max(0,F.split(/\s+/).length-1);E[$]=y;const B=E.join(" "),M=E.slice(0,$),x=M.join(" ").length+(M.length>0?1:0)+y.length;return{newInput:B,newCursorPosition:x}},[I]),T=a.useCallback(()=>{u(!1),i(-1)},[]),k=a.useCallback(()=>{n.length>0&&u(!0)},[n.length]),v=a.useCallback(()=>{s([]),i(-1),u(!1)},[]),g=a.useCallback((d,w)=>{const h=m(d,w);if(h.completions.length===1)return j(d,w,h.completions[0]);if(h.completions.length>1&&h.commonPrefix){const y=d.split(/\s+/),E=d.substring(0,w),F=Math.max(0,E.split(/\s+/).length-1),$=y[F]||"";if(h.commonPrefix.length>$.length)return j(d,w,h.commonPrefix)}return S(d,w),{newInput:d,newCursorPosition:w}},[m,j,S]),f=n.length>0,b=c>=0&&c<n.length;return{suggestions:n,selectedIndex:c,isVisible:l,hasSuggestions:f,hasSelection:b,updateSuggestions:S,navigateSuggestions:L,selectSuggestion:N,getSelectedSuggestion:I,applyCompletion:j,getTabCompletion:g,hideSuggestions:T,showSuggestions:k,clearSuggestions:v}}function be(r){if(r.length===0)return"";if(r.length===1)return r[0];let e="";const[t]=r;for(let o=0;o<t.length;o++){const n=t[o];if(r.every(s=>s[o]===n))e+=n;else break}return e}function mr(){const{fileSystem:r,createFile:e,createFolder:t,removeFileSystemItem:o}=Fe(),[n,s]=a.useState({output:[],currentInput:"",currentDirectory:"/Desktop",history:[],historyIndex:-1,osType:"linux",isExecuting:!1,theme:X,username:"portfolio",hostname:"thalison",env:{PATH:"/usr/local/bin:/usr/bin:/bin",HOME:"/Desktop",USER:"portfolio"},suggestions:[],showSuggestions:!1,selectedSuggestion:-1,cursorPosition:0}),c=a.useRef(ye(n.osType)),i=c.current,l=a.useRef(!1),{addToHistory:u,navigateHistory:m,searchHistory:S,resetHistoryIndex:L,clearHistory:N}=ar(n.osType),{suggestions:I,selectedIndex:j,isVisible:T,updateSuggestions:k,navigateSuggestions:v,getTabCompletion:g,hideSuggestions:f,clearSuggestions:b}=ur(i,n.currentDirectory,r,n.osType);a.useEffect(()=>{c.current=ye(n.osType),s(x=>({...x,theme:x.osType==="linux"?X:fe}))},[n.osType]);const d=a.useCallback((x,D="output")=>{const W=Y.acquire();W.id=`line-${Date.now()}-${Math.random()}`,W.content=x,W.type=D,W.timestamp=new Date,W.className="",s(R=>{const O=[...R.output,W];let H=O;return O.length>1e3&&(O.slice(0,O.length-1e3).forEach(P=>Y.release(P)),H=O.slice(-1e3)),{...R,output:H}})},[]),w=a.useCallback(()=>{s(x=>(x.output.forEach(D=>Y.release(D)),{...x,output:[]}))},[]),h=a.useCallback((x,D,W)=>{s(R=>({...R,currentInput:x,cursorPosition:D??x.length})),W||L(),x.trim()?k(x,D??x.length):b()},[L,k,b]),y=a.useCallback(()=>{if(n.osType==="windows"){const D=`C:\\${n.currentDirectory.replace(/\//g,"\\")}`;return`<span style="color: ${n.theme.prompt}; font-weight: bold;">${D}></span> `}const x=n.currentDirectory==="/Desktop"?"~":n.currentDirectory;return`<span style="color: ${n.theme.success}; font-weight: bold;">${n.username}</span><span style="color: ${n.theme.foreground};">@</span><span style="color: ${n.theme.directory}; font-weight: bold;">${n.hostname}</span><span style="color: ${n.theme.foreground};">:</span><span style="color: ${n.theme.directory}; font-weight: bold;">${x}</span><span style="color: ${n.theme.prompt}; font-weight: bold;">$</span> `},[n.osType,n.currentDirectory,n.username,n.hostname,n.theme]),E=a.useCallback(async x=>{const D=x.trim(),W=y();if(d(`${W}${x}`,"input"),!D){s(R=>({...R,currentInput:"",cursorPosition:0}));return}u(D),s(R=>({...R,isExecuting:!0}));try{const R=Ne.parse(D);if(!R.command){s(P=>({...P,isExecuting:!1}));return}const O=i.getCommand(R.command);if(!O){const P=n.osType==="windows"?`'${R.command}' is not recognized as an internal or external command, operable program or batch file.`:`${R.command}: command not found`;d(P,"error"),s(z=>({...z,isExecuting:!1}));return}const H={currentDirectory:n.currentDirectory,osType:n.osType,env:n.env,history:n.history,fileSystem:r,username:n.username,hostname:n.hostname,createFile:e,createFolder:t,removeFileSystemItem:o},A=await O.execute(R.args,H);if(A.type==="vim"&&A.vimData){s(P=>({...P,isVimMode:!0,vimData:A.vimData,isExecuting:!1,currentInput:"",cursorPosition:0}));return}A.clear?w():A.output&&d(A.output,(A.type==="vim"?"output":A.type)||"output"),A.error&&d(A.error,"error"),A.newDirectory&&s(P=>({...P,currentDirectory:A.newDirectory})),A.exit&&d("Terminal session ended.","info")}catch(R){console.error("Command execution error:",R),d(`Error executing command: ${R}`,"error")}finally{s(R=>({...R,isExecuting:!1,currentInput:"",cursorPosition:0})),f()}},[n.osType,n.currentDirectory,n.username,n.hostname,n.env,n.history,d,u,i,r,w,f,y,e,t,o]),F=a.useCallback(x=>{if(!n.isExecuting)switch(x.key){case"Enter":x.preventDefault(),E(n.currentInput);break;case"ArrowUp":if(x.preventDefault(),T)v("up");else{const D=m("up");D!==null&&h(D,void 0,!0)}break;case"ArrowDown":if(x.preventDefault(),T)v("down");else{const D=m("down");D!==null&&h(D,void 0,!0)}break;case"Tab":{x.preventDefault();const D=g(n.currentInput,n.cursorPosition);h(D.newInput,D.newCursorPosition);break}case"Escape":x.preventDefault(),f();break;case"c":if(x.ctrlKey){x.preventDefault();const D=y();d(`${D}${n.currentInput}^C`,"input"),h(""),f()}break;case"l":x.ctrlKey&&(x.preventDefault(),w());break;case"r":x.ctrlKey&&(x.preventDefault(),d("(reverse-i-search): ","info"));break}},[n.isExecuting,n.currentInput,n.cursorPosition,T,E,v,m,g,h,f,d,w,y]),$=a.useCallback(x=>{n.osType!==x&&(s(D=>({...D,osType:x,theme:x==="linux"?X:fe})),i.switchOS(x),d(`Switched to ${x==="linux"?"Linux":"Windows"} mode`,"info"))},[n.osType,i,d]),B=a.useCallback(()=>{s(x=>({...x,isVimMode:!1,vimData:void 0}))},[]),M=a.useCallback(()=>{if(n.osType==="windows")return`C:\\${n.currentDirectory.replace(/\//g,"\\")}> `;const x=n.currentDirectory==="/Desktop"?"~":n.currentDirectory;return`${n.username}@${n.hostname}:${x}$ `},[n.osType,n.currentDirectory,n.username,n.hostname]);return a.useEffect(()=>{if(l.current)return;["Portfolio Desktop Terminal v1.0.0",`Running in ${n.osType==="linux"?"Linux":"Windows"} mode`,'Type "help" for available commands',"Use Ctrl+L to clear, Ctrl+C to interrupt",""].forEach(D=>d(D,"info")),l.current=!0},[d,n.osType]),a.useEffect(()=>{const x=setInterval(()=>{ee.forceGC();const D=ee.getAllStats();D.terminalLines.poolSize>150&&console.log("Terminal: Pool statistics",D)},3e4);return()=>{clearInterval(x)}},[]),a.useEffect(()=>()=>{n.output.forEach(x=>Y.release(x)),ee.clearAll()},[n.output]),{output:n.output,currentInput:n.currentInput,currentDirectory:n.currentDirectory,osType:n.osType,isExecuting:n.isExecuting,theme:n.theme,username:n.username,hostname:n.hostname,cursorPosition:n.cursorPosition,isVimMode:n.isVimMode,vimData:n.vimData,suggestions:I,selectedIndex:j,showSuggestions:T,updateInput:h,executeCommand:E,clearOutput:w,switchOS:$,handleKeyDown:F,getCurrentPrompt:M,exitVimMode:B,clearHistory:N,searchHistory:S,commandRegistry:i,fileSystem:r,createFile:e,createFolder:t,removeFileSystemItem:o}}const fr=({initialOS:r="linux",showOSSwitcher:e=!0})=>{const t=a.useRef(null),[o,n]=a.useState(!1),s=a.useRef(null),{output:c,currentInput:i,currentDirectory:l,osType:u,isExecuting:m,theme:S,username:L,hostname:N,cursorPosition:I,isVimMode:j,vimData:T,suggestions:k,selectedIndex:v,showSuggestions:g,updateInput:f,clearOutput:b,switchOS:d,handleKeyDown:w,clearHistory:h,exitVimMode:y,createFile:E,commandRegistry:F}=mr();s.current=w,a.useEffect(()=>{const P=t.current;if(!P)return;const z=()=>{const G=P.querySelector(".terminal-input");G&&G.focus()},q=G=>{const Be=P.contains(document.activeElement),de=document.activeElement?.classList.contains("terminal-input");if(G.ctrlKey&&!de&&s.current){s.current(G);return}de||Be&&s.current&&s.current(G)};return P.addEventListener("click",z),document.addEventListener("keydown",q),()=>{P.removeEventListener("click",z),document.removeEventListener("keydown",q)}},[]),a.useEffect(()=>{o||(r!==u&&d(r),n(!0))},[r,u,d,o]);const $=P=>{d(P)},B=async(P,z)=>{try{return E?.(T?.currentDirectory||l,P,z)||!1}catch(q){return console.error("Error saving file:",q),!1}},M=async P=>"",x=P=>!1,D={display:"flex",flexDirection:"column",height:"100%",width:"100%",backgroundColor:S.background,color:S.foreground,fontFamily:'Monaco, Menlo, "Ubuntu Mono", Consolas, "Courier New", monospace',fontSize:"14px",overflow:"hidden",position:"relative"},W={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",backgroundColor:S.selection,borderBottom:`1px solid ${S.comment}`,fontSize:"12px",color:S.comment},R={display:"flex",gap:"8px",alignItems:"center"},O=(P,z=!1)=>({padding:"4px 8px",border:"none",backgroundColor:P?S.foreground:"transparent",color:P?S.background:S.comment,fontSize:"11px",borderRadius:"3px",cursor:z?"not-allowed":"pointer",fontFamily:"inherit",transition:"all 0.2s ease",opacity:z&&!P?.5:1}),H={display:"flex",alignItems:"center",gap:"8px",fontSize:"11px",fontWeight:"bold"},A={display:"flex",alignItems:"center",gap:"12px",fontSize:"11px"};return p.jsxs("div",{ref:t,style:D,className:"terminal-app",tabIndex:0,role:"application","aria-label":"Terminal Application",children:[j&&T?p.jsx(Tt,{filename:T.filename,currentDirectory:T.currentDirectory,theme:S,onExit:y,onSaveFile:B,onLoadFile:M,onFileExists:x}):p.jsxs(p.Fragment,{children:[p.jsxs("div",{style:W,className:"terminal-header",children:[p.jsxs("div",{style:H,children:[p.jsx("span",{children:"📟"}),p.jsx("span",{children:"Terminal"})]}),p.jsxs("div",{style:A,children:[p.jsx("span",{children:u==="linux"?"🐧 Linux":"🪟 Windows"}),m&&p.jsxs(p.Fragment,{children:[p.jsx("span",{children:"|"}),p.jsx("span",{style:{color:S.warning},children:"Running..."})]})]}),e&&p.jsxs("div",{style:R,children:[p.jsx("span",{style:{fontSize:"11px",color:S.comment},children:"OS:"}),p.jsx("button",{style:O(u==="linux",m||u==="linux"),onClick:()=>$("linux"),disabled:m||u==="linux",title:u==="linux"?"Already in Linux mode":"Switch to Linux mode",children:"Linux"}),p.jsx("button",{style:O(u==="windows",m||u==="windows"),onClick:()=>$("windows"),disabled:m||u==="windows",title:u==="windows"?"Already in Windows mode":"Switch to Windows mode",children:"Windows"})]})]}),p.jsx(Se,{output:c,theme:S,autoScroll:!0,maxLines:1e3,currentInput:i,onInputChange:f,onKeyDown:w,currentDirectory:l,osType:u,username:L,hostname:N,isExecuting:m,cursorPosition:I,suggestions:k,selectedSuggestion:v,showSuggestions:g,commandRegistry:F}),p.jsxs("div",{style:{position:"absolute",left:"-9999px"},children:[p.jsx("button",{onClick:b,"aria-label":"Clear terminal output",children:"Clear (Ctrl+L)"}),p.jsx("button",{onClick:h,"aria-label":"Clear command history",children:"Clear History"})]})]}),p.jsx("style",{children:`
        .terminal-app {
          font-variant-ligatures: none;
          -webkit-font-feature-settings: "liga" 0;
          font-feature-settings: "liga" 0;
        }
        
        .terminal-app *:focus {
          outline: none;
        }
        
        .terminal-input::selection {
          background-color: ${S.selection};
          color: ${S.foreground};
        }
        
        .terminal-suggestion:hover {
          background-color: ${S.selection} !important;
          color: ${S.foreground} !important;
        }
        
        .terminal-line {
          animation: fadeIn 0.1s ease-in;
        }
        
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(2px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes blink {
          0%, 50% { opacity: 1; }
          51%, 100% { opacity: 0; }
        }
        
        .terminal-cursor {
          animation: blink 1s infinite;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
          .terminal-header {
            flex-direction: column;
            gap: 8px;
            padding: 12px 16px;
          }
          
          .terminal-input-container {
            padding: 12px 0px;
          }
          
          .terminal-output {
            padding: 12px 16px;
          }
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
          .terminal-app {
            border: 2px solid ${S.foreground};
          }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
          .terminal-line {
            animation: none;
          }
          
          .terminal-cursor {
            animation: none;
            opacity: 1;
          }
        }
      `})]})};export{fr as TerminalApp};
