import{u as z,a as H,r as i,j as l,R as T,I,C as V}from"./index-CgCM4PKA.js";const O=()=>{const{fileSystem:h,createFile:p,createFolder:b,removeFileSystemItem:v,renameFileSystemItem:F,copyToClipboard:g,cutToClipboard:y,pasteFromClipboard:C,clipboard:D}=z(),{showContextMenu:P}=H(),[a,n]=i.useState({currentPath:"/Desktop",selectedItems:[],viewMode:"grid",sortBy:"name",sortOrder:"asc",searchQuery:"",isRenaming:null,showNewFolderDialog:!1,showNewFileDialog:!1,showDeleteDialog:!1,navigationHistory:["/Desktop"],historyIndex:0,showSidebar:!0,expandedFolders:new Set(["/Desktop"])}),f=i.useMemo(()=>{const e=(t,s)=>{for(const r of t){if(r.path===s&&r.type==="folder")return r;if(r.children&&s.startsWith(`${r.path}/`)){const c=e(r.children,s);if(c)return c}}return null};return e(h,a.currentPath)},[h,a.currentPath]),u=i.useMemo(()=>{if(!f?.children)return[];let e=[...f.children];if(a.searchQuery){const t=a.searchQuery.toLowerCase();e=e.filter(s=>s.name.toLowerCase().includes(t))}return e.sort((t,s)=>{let r=0;switch(a.sortBy){case"name":r=t.name.localeCompare(s.name);break;case"type":{if(t.type!==s.type)r=t.type==="folder"?-1:1;else{const c=t.name.includes(".")&&t.name.split(".").pop()||"",d=s.name.includes(".")&&s.name.split(".").pop()||"";r=c.localeCompare(d)}break}case"size":{const c=t.type==="folder"?0:t.content?.length||0,d=s.type==="folder"?0:s.content?.length||0;r=c-d;break}case"date":r=t.name.localeCompare(s.name);break;default:r=t.name.localeCompare(s.name);break}return a.sortOrder==="asc"?r:-r}),e},[f,a.searchQuery,a.sortBy,a.sortOrder]),m=i.useCallback(e=>{n(t=>{const s=t.navigationHistory.slice(0,t.historyIndex+1);return s.push(e),{...t,currentPath:e,selectedItems:[],navigationHistory:s,historyIndex:s.length-1}})},[]),S=i.useCallback(()=>{n(e=>{if(e.historyIndex>0){const t=e.historyIndex-1;return{...e,currentPath:e.navigationHistory[t],selectedItems:[],historyIndex:t}}return e})},[]),M=i.useCallback(()=>{n(e=>{if(e.historyIndex<e.navigationHistory.length-1){const t=e.historyIndex+1;return{...e,currentPath:e.navigationHistory[t],selectedItems:[],historyIndex:t}}return e})},[]),x=i.useCallback(()=>{const e=a.currentPath.split("/").slice(0,-1).join("/")||"/";e!==a.currentPath&&m(e)},[a.currentPath,m]),k=i.useCallback((e,t=!1)=>{n(s=>{if(t){const r=s.selectedItems.includes(e);return{...s,selectedItems:r?s.selectedItems.filter(c=>c!==e):[...s.selectedItems,e]}}return{...s,selectedItems:[e]}})},[]),N=i.useCallback(e=>{if(e.type==="folder"){m(e.path);return}},[m]),o=i.useCallback((e,t)=>{switch(e){case"new-folder":n(s=>({...s,showNewFolderDialog:!0}));break;case"new-file":n(s=>({...s,showNewFileDialog:!0}));break;case"delete":a.selectedItems.length>0&&n(s=>({...s,showDeleteDialog:!0}));break;case"copy":if(a.selectedItems.length>0){const s=a.selectedItems.map(r=>u.find(c=>c.id===r)?.path).filter(Boolean);g(s)}break;case"cut":if(a.selectedItems.length>0){const s=a.selectedItems.map(r=>u.find(c=>c.id===r)?.path).filter(Boolean);y(s)}break;case"paste":C(a.currentPath);break;case"rename":a.selectedItems.length===1&&n(s=>({...s,isRenaming:a.selectedItems[0]}));break}},[a.selectedItems,a.currentPath,u,g,y,C]),j=i.useMemo(()=>{const e=a.currentPath.split("/").filter(Boolean),t=[{name:"Computer",path:"/"}];let s="";for(const r of e)s+=`/${r}`,t.push({name:r,path:s});return t},[a.currentPath]),B=i.useCallback(e=>{n(t=>{const s=new Set(t.expandedFolders);return s.has(e)?s.delete(e):s.add(e),{...t,expandedFolders:s}})},[]),$=i.useMemo(()=>{const e=(t,s=0)=>{const r=[],c=t.filter(d=>d.type==="folder").sort((d,w)=>d.name.localeCompare(w.name));for(const d of c){const w=(d.children||[]).some(R=>R.type==="folder");r.push({item:d,level:s,hasChildren:w}),a.expandedFolders.has(d.path)&&d.children&&r.push(...e(d.children,s+1))}return r};return e(h)},[h,a.expandedFolders]),E=i.useCallback(()=>{n(e=>({...e,showSidebar:!e.showSidebar}))},[]);return i.useEffect(()=>{const e=t=>{if(t.ctrlKey)switch(t.key){case"c":t.preventDefault(),o("copy");break;case"x":t.preventDefault(),o("cut");break;case"v":t.preventDefault(),o("paste");break;case"a":t.preventDefault(),n(s=>({...s,selectedItems:u.map(r=>r.id)}));break}else switch(t.key){case"Delete":o("delete");break;case"F2":o("rename");break;case"Backspace":x();break}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o,x,u]),l.jsxs("div",{className:"file-explorer",children:[l.jsxs("div",{className:"file-explorer-toolbar",children:[l.jsxs("div",{className:"toolbar-section",children:[l.jsx("button",{className:"toolbar-button",onClick:S,disabled:a.historyIndex===0,title:"Back",children:"◀"}),l.jsx("button",{className:"toolbar-button",onClick:M,disabled:a.historyIndex===a.navigationHistory.length-1,title:"Forward",children:"▶"}),l.jsx("button",{className:"toolbar-button",onClick:x,disabled:a.currentPath==="/"||a.currentPath==="",title:"Up",children:"⬆"}),l.jsx("button",{className:`toolbar-button ${a.showSidebar?"active":""}`,onClick:E,title:"Toggle Sidebar",children:"📁 Sidebar"})]}),l.jsxs("div",{className:"toolbar-section",children:[l.jsx("button",{className:"toolbar-button",onClick:()=>o("new-folder"),title:"New Folder",children:"📁+ New Folder"}),l.jsx("button",{className:"toolbar-button",onClick:()=>o("new-file"),title:"New File",children:"📄+ New File"})]}),l.jsxs("div",{className:"toolbar-section",children:[l.jsx("button",{className:"toolbar-button",onClick:()=>o("copy"),disabled:a.selectedItems.length===0,title:"Copy (Ctrl+C)",children:"📋 Copy"}),l.jsx("button",{className:"toolbar-button",onClick:()=>o("cut"),disabled:a.selectedItems.length===0,title:"Cut (Ctrl+X)",children:"✂ Cut"}),l.jsx("button",{className:"toolbar-button",onClick:()=>o("paste"),disabled:!D.items.length,title:"Paste (Ctrl+V)",children:"📋 Paste"}),l.jsx("button",{className:"toolbar-button",onClick:()=>o("delete"),disabled:a.selectedItems.length===0,title:"Delete (Del)",children:"🗑 Delete"})]}),l.jsxs("div",{className:"toolbar-section",children:[l.jsx("button",{className:`toolbar-button ${a.viewMode==="grid"?"active":""}`,onClick:()=>n(e=>({...e,viewMode:"grid"})),title:"Grid View",children:"⊞"}),l.jsx("button",{className:`toolbar-button ${a.viewMode==="list"?"active":""}`,onClick:()=>n(e=>({...e,viewMode:"list"})),title:"List View",children:"≡"}),l.jsx("button",{className:`toolbar-button ${a.viewMode==="details"?"active":""}`,onClick:()=>n(e=>({...e,viewMode:"details"})),title:"Details View",children:"☰"})]})]}),l.jsxs("div",{className:"file-explorer-address-bar",children:[l.jsx("div",{className:"address-breadcrumbs",children:j.map((e,t)=>l.jsxs(T.Fragment,{children:[l.jsx("button",{className:"breadcrumb-item",onClick:()=>m(e.path),children:e.name}),t<j.length-1&&l.jsx("span",{className:"breadcrumb-separator",children:"▶"})]},e.path))}),l.jsx("div",{className:"search-section",children:l.jsx("input",{type:"text",className:"search-input",placeholder:"Search files...",value:a.searchQuery,onChange:e=>n(t=>({...t,searchQuery:e.target.value}))})})]}),l.jsxs("div",{className:"file-explorer-main",children:[a.showSidebar&&l.jsxs("div",{className:"file-explorer-sidebar",children:[l.jsx("div",{className:"sidebar-header",children:l.jsx("span",{className:"sidebar-title",children:"Folders"})}),l.jsx("div",{className:"folder-tree",children:$.map(({item:e,level:t,hasChildren:s})=>l.jsx("div",{className:`tree-item ${a.currentPath===e.path?"active":""}`,style:{paddingLeft:`${t*16+8}px`},onClick:()=>m(e.path),children:l.jsxs("div",{className:"tree-item-content",children:[s&&l.jsx("button",{className:"tree-expand-button",onClick:r=>{r.stopPropagation(),B(e.path)},children:a.expandedFolders.has(e.path)?"▼":"▶"}),!s&&l.jsx("span",{className:"tree-spacer"}),l.jsx("span",{className:"tree-icon",children:"📁"}),l.jsx("span",{className:"tree-label",children:e.name})]})},e.id))})]}),l.jsx("div",{className:"file-explorer-content",children:l.jsx("div",{className:`file-display file-display--${a.viewMode}`,children:u.length===0?l.jsx("div",{className:"empty-folder",children:l.jsx("p",{children:"This folder is empty"})}):u.map(e=>l.jsxs("div",{className:`file-item ${a.selectedItems.includes(e.id)?"selected":""} ${a.isRenaming===e.id?"renaming":""}`,onClick:t=>k(e.id,t.ctrlKey),onDoubleClick:()=>N(e),onContextMenu:t=>{t.preventDefault(),k(e.id),P({x:t.clientX,y:t.clientY},[{id:"open",label:"Open",onClick:()=>N(e)},{id:"separator1",label:"",separator:!0},{id:"rename",label:"Rename",onClick:()=>o("rename")},{id:"delete",label:"Delete",onClick:()=>o("delete")},{id:"separator2",label:"",separator:!0},{id:"copy",label:"Copy",onClick:()=>o("copy")},{id:"cut",label:"Cut",onClick:()=>o("cut")}])},children:[l.jsx("div",{className:"file-icon",children:e.type==="folder"?"📁":L(e.name)}),l.jsx("div",{className:"file-name",children:a.isRenaming===e.id?l.jsx("input",{type:"text",className:"rename-input",defaultValue:e.name,onBlur:t=>{const s=t.target.value.trim();s&&s!==e.name&&F(e.path,s),n(r=>({...r,isRenaming:null}))},onKeyDown:t=>{t.key==="Enter"?t.currentTarget.blur():t.key==="Escape"&&n(s=>({...s,isRenaming:null}))},autoFocus:!0,onClick:t=>t.stopPropagation()}):e.name}),a.viewMode==="details"&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"file-type",children:e.type}),l.jsx("div",{className:"file-size",children:e.type==="folder"?"":Q(e.content?.length||0)})]})]},e.id))})})]}),l.jsx("div",{className:"file-explorer-status-bar",children:l.jsxs("span",{children:[u.length," item",u.length!==1?"s":"",a.selectedItems.length>0&&l.jsxs(l.Fragment,{children:[", ",a.selectedItems.length," selected"]})]})}),l.jsx(I,{isVisible:a.showNewFolderDialog,title:"Create New Folder",label:"Folder name:",placeholder:"New folder",onConfirm:e=>{b(a.currentPath,e),n(t=>({...t,showNewFolderDialog:!1}))},onCancel:()=>n(e=>({...e,showNewFolderDialog:!1})),validate:e=>e.trim()?u.some(t=>t.name===e.trim())?"A folder with this name already exists":null:"Folder name is required"}),l.jsx(I,{isVisible:a.showNewFileDialog,title:"Create New File",label:"File name:",placeholder:"New file.txt",onConfirm:e=>{p(a.currentPath,e,""),n(t=>({...t,showNewFileDialog:!1}))},onCancel:()=>n(e=>({...e,showNewFileDialog:!1})),validate:e=>e.trim()?u.some(t=>t.name===e.trim())?"A file with this name already exists":null:"File name is required"}),l.jsx(V,{isVisible:a.showDeleteDialog,title:"Delete Items",message:`Are you sure you want to delete ${a.selectedItems.length} item${a.selectedItems.length!==1?"s":""}?`,onConfirm:()=>{a.selectedItems.forEach(e=>{const t=u.find(s=>s.id===e);t&&v(t.path)}),n(e=>({...e,showDeleteDialog:!1,selectedItems:[]}))},onCancel:()=>n(e=>({...e,showDeleteDialog:!1}))})]})};function L(h){switch(h.split(".").pop()?.toLowerCase()){case"txt":case"md":return"📄";case"doc":case"docx":return"📘";case"xls":case"xlsx":return"📗";case"ppt":case"pptx":return"📙";case"zip":case"rar":case"7z":return"📦";case"jpg":case"jpeg":case"png":case"gif":case"bmp":return"🖼";case"mp3":case"wav":case"flac":return"🎵";case"mp4":case"avi":case"mkv":case"mov":return"🎬";case"js":case"ts":case"jsx":case"tsx":return"⚡";case"html":case"css":return"🌐";case"py":return"🐍";case"java":return"☕";case"cpp":case"c":return"🔧";default:return"📋"}}function Q(h){if(h===0)return"0 B";const p=["B","KB","MB","GB"],b=Math.floor(Math.log(h)/Math.log(1024));return`${(h/Math.pow(1024,b)).toFixed(1)} ${p[b]}`}export{O as FileExplorerApp};
